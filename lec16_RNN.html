
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>22. Sequential Data Using Recurrent Neural Networks &#8212; Neural Networks and Deep Learning - DATA621</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/tabs.css?v=4c969af8" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=87e54e7c" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script src="_static/tabs.js?v=3ee01567"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script async="async" kind="hypothesis" src="https://hypothes.is/embed.js"></script>
    <script kind="utterances">

    var commentsRunWhenDOMLoaded = cb => {
    if (document.readyState != 'loading') {
        cb()
    } else if (document.addEventListener) {
        document.addEventListener('DOMContentLoaded', cb)
    } else {
        document.attachEvent('onreadystatechange', function() {
        if (document.readyState == 'complete') cb()
        })
    }
}

var addUtterances = () => {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src = "https://utteranc.es/client.js";
    script.async = "async";

    script.setAttribute("repo", "cfteach/NNDL_DATA621");
    script.setAttribute("issue-term", "pathname");
    script.setAttribute("theme", "github-light");
    script.setAttribute("label", "💬 comment");
    script.setAttribute("crossorigin", "anonymous");

    sections = document.querySelectorAll("div.section");
    if (sections !== null) {
        section = sections[sections.length-1];
        section.appendChild(script);
    }
}
commentsRunWhenDOMLoaded(addUtterances);
</script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'lec16_RNN';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="canonical" href="https://cfteach.github.io/NNDL_DATA621/lec16_RNN.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="References" href="referencesmc.html" />
    <link rel="prev" title="21. Nobel Prize (2024)" href="nobel2024.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>
<aside class="bd-header-announcement" aria-label="Announcement">
  <div class="bd-header-announcement__content">This page is being updated</div>
</aside>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logowm1.png" class="logo__image only-light" alt="Neural Networks and Deep Learning - DATA621 - Home"/>
    <script>document.write(`<img src="_static/logowm1.png" class="logo__image only-dark" alt="Neural Networks and Deep Learning - DATA621 - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Welcome to DATA621 - Neural Networks and Deep Learning
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Syllabus</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference external" href="https://drive.google.com/file/d/1ClOsYfLTa0Ts7wpULnnHOvemG2Vk36Nv/view?usp=share_link">Syllabus (last update 10/6/2024)</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Schedule</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="schedule.html">Schedule</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Assignments</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference external" href="https://drive.google.com/file/d/1aW_ZdzN2D5W51rYIujfuqcMYzCYKRZzb/view?usp=sharing">Assignment 1, Deep Neural Networks from Scratch</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Intro</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference external" href="https://docs.google.com/presentation/d/1nF3Y5hcuumYLgekjGXFy1ATGehg7gov_IXzJahMwOS0/edit?usp=sharing">Welcome and Intro by Prof. C.Fanelli</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">[Pre-flight] Intro to Modeling</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference external" href="https://docs.google.com/presentation/d/1BV2-N-c1bq4yx1IsPMW4fhC9i1SCdRAU/edit?usp=sharing&amp;ouid=113195593718692427789&amp;rtpof=true&amp;sd=true">Linear Regression (lecture slides)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Linear_Regression_1_class.html">1. Linear Regression (Jupyter Notebook)</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">[Pre-flight] Introduction to git</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="Day-1/GIT-course/intro_to_git.html">2. Brief course on <code class="docutils literal notranslate"><span class="pre">git</span></code></a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="Day-1/GIT-course/VCS.html">2.1. Version Control System (VCS)</a></li>
<li class="toctree-l2"><a class="reference internal" href="Day-1/GIT-course/git_basics.html">2.2. What is Git?</a></li>
<li class="toctree-l2"><a class="reference internal" href="Day-1/GIT-course/git_configure.html">2.3. Configuring your <code class="docutils literal notranslate"><span class="pre">git</span></code></a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="Day-1/GIT-course/git_exercises.html">3. Exercises on <code class="docutils literal notranslate"><span class="pre">git</span></code></a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="Day-1/GIT-course/Exercise-1.html">3.1. Exercise 1: Basic Git Commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="Day-1/GIT-course/Exercise-2.html">3.2. Exercise 2: Commits, push and branches</a></li>
<li class="toctree-l2"><a class="reference internal" href="Day-1/GIT-course/Exercise-3.html">3.3. Advanced exercises</a></li>
<li class="toctree-l2"><a class="reference internal" href="Day-1/GIT-course/Exercise-4.html">3.4. GitHub Actions and Workflow Tutorial</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">[Pre-flight] Using VS-Code</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Day-1/VS-code.html">Installing Visual Studio Code</a></li>


</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">[8/29/2024] Introduction to High Performance Computing (HPC)</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="Day-1/HPC-course/intro_to_HPC_HTC.html">4. Introduction to High Performance Computing</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="Day-1/HPC-course/intro_to_HPC.html">4.1. High Performance Computing</a></li>
<li class="toctree-l2"><a class="reference internal" href="Day-1/HPC-course/ssh_login.html">4.2. SSH into a Front-End Node Using Proxy Jump</a></li>
<li class="toctree-l2"><a class="reference internal" href="Day-1/HPC-course/file_systems_WM.html">4.3. William &amp; Mary Research Computing: File Systems Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="Day-1/HPC-course/SLURM_commands2.html">4.4. Introduction to SLURM</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">[9/3/2024] Linear Classifiers</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference external" href="https://docs.google.com/presentation/d/1rEUGMhcfUyC5YCgrIRnqoRU6jNgzaO9EuvnxePEfo8k/edit?usp=sharing">Perceptrons (lecture slides)</a></li>
<li class="toctree-l1"><a class="reference external" href="https://drive.google.com/file/d/1mU67w6GAhIWNFoO98AF7u8in2C-Op4Ag/view?usp=sharing">Perceptron - Proof of Convergence (PDF)</a></li>
<li class="toctree-l1"><a class="reference internal" href="lec2_perceptron_DATA621.html">5. Training a Perceptron (Jupyter notebook)</a></li>
<li class="toctree-l1"><a class="reference external" href="https://docs.google.com/presentation/d/1Ep46Bmw_bIr8PLAVPNzVlB0bExEvobGinLnNzCBHS7o/edit?usp=sharing">Adaline (lecture slides)</a></li>
<li class="toctree-l1"><a class="reference internal" href="lec2_adaline_DATA621.html">6. Training Adaline (Jupyter notebook)</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">[9/5/2024] Gradient Descent, stochastic GD, Logistic Regression and Other classifiers</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference external" href="https://docs.google.com/presentation/d/1osZ2o-DtNNHuUGjDkurYuyrg439WBoucJrvMK5c4ibg/edit?usp=sharing">Stochastic Gradient Descent, Logistic Regression (lecture slides)</a></li>
<li class="toctree-l1"><a class="reference internal" href="lec3_GDvsSGD_DATA621.html">7. Gradient Descent, Stochastic Gradient Descent, Mini-batch GD (Jupyter notebook)</a></li>
<li class="toctree-l1"><a class="reference internal" href="lec3_logistic_reg_DATA621.html">8. Logistic Regression, Regularization, linear (and non-linear) boundaries</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">[9/10/2024] Building Training Datasets</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference external" href="https://docs.google.com/presentation/d/1uPs3MhCrPNDglKWcaRBWm8ay_7EtlPWNzmQN6exYSDM/edit?usp=sharing">Building Training Datasets (lecture slides)</a></li>
<li class="toctree-l1"><a class="reference internal" href="lec4_datapreprocessing.html">9. Data Preprocessing (Jupyter notebook)</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">[9/12/2024] Model Evaluation, Hyperparameter Tuning: Examples and Discussion</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="lec5_modeleval.html">10. Model Evaluation, Hyperparameter Tuning (Jupyter notebook)</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">[9/17/2024, 9/19/2024] Building Multi-Layer Neural Networks from scratch + discussion on assignment</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference external" href="https://docs.google.com/presentation/d/1AmB1djkmLFcwzgfBoY0l1xe-gLEPx8wFj4OHZuqFg_Y/edit?usp=sharing"> Adding hidden layers + Math of Backprop (lecture slides)</a></li>
<li class="toctree-l1"><a class="reference internal" href="lec6_MLP_DATA621_sol.html">11. Multi-Layer Perceptron (Jupyter notebook)</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">[9/24/2024] Building Multi-Layer Neural Networks with PyTorch</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="lec8_NN_preflight.html">12. Using PyTorch preflight (Jupyter notebook)</a></li>
<li class="toctree-l1"><a class="reference internal" href="lec8_NN_pytorch_nosol.html">13. Using torch.nn (Jupyter notebook)</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">[9/26/2024] PyTorch and Autograd</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="lec9_autograd_pytorch.html">14. Using PyTorch Autograd (Jupyter notebook)</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">[10/1, 10/3, 10/8/2024] CNN with PyTorch</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="lec10_CNN_DATA621.html">15. Using PyTorch with CNN</a></li>
<li class="toctree-l1"><a class="reference internal" href="lec11_cnn2_v2.html">16. Using CNN and Celeb Dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="lec12_cnn_regr-2.html">17. Using CNN for Regression Tasks (age prediction based on images)</a></li>
<li class="toctree-l1"><a class="reference internal" href="lec12_UNet.html">18. Using U-Net for Image Segmentation</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">[10/15, 10/17/2024] Explainable AI using Grad-CAM for visual explanations</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="lec13_Introduction_to_grad_cam_v2.html">19. Introduction to Grad-CAM</a></li>
<li class="toctree-l1"><a class="reference internal" href="lec14_Introduction_to_grad_cam_part2.html">20. Grad-CAM (part 2)</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">[10/22, 10/24/2024] Recurrent Neural Network</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="nobel2024.html">21. 2024 Nobel Prize in Physics: Hopfield NN and Boltzmann Machines</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">22. LSTM Recurrent Neural Networks</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Additional resources</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="referencesmc.html">References</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/cfteach/NNDL_DATA621/blob/webpage-src/DATA621/DATA621/lec16_RNN.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Colab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Colab logo" src="_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="initThebeSBT()"
  class="btn btn-sm btn-launch-thebe dropdown-item"
  title="Launch Thebe"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="btn__text-container">Live Code</span>
</button>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/cfteach/NNDL_DATA621" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/cfteach/NNDL_DATA621/edit/webpage-src/DATA621/DATA621/lec16_RNN.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/cfteach/NNDL_DATA621/issues/new?title=Issue%20on%20page%20%2Flec16_RNN.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/lec16_RNN.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Sequential Data Using Recurrent Neural Networks</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#warming-up">22.1. Warming up</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#working-with-the-internet-movie-database-imdb">22.2. Working with the Internet Movie Database (IMDb)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#embedding-layers-for-sentence-encoding">22.3. Embedding layers for sentence encoding</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#building-an-rnn-model">22.4. Building an RNN model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#building-an-rnn-model-for-the-sentiment-analysis-task">22.5. Building an RNN model for the sentiment analysis task</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#select-one-random-comment-in-the-test-dataset-and-compute-prediction">22.6. Select one random comment in the test dataset and compute prediction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#build-a-bi-directional-lstm">22.7. Build a bi-directional LSTM</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <p>Credits: inspired by Raschka et al., Chap 15 - substantial changes applied</p>
<section id="sequential-data-using-recurrent-neural-networks">
<h1><span class="section-number">22. </span>Sequential Data Using Recurrent Neural Networks<a class="headerlink" href="#sequential-data-using-recurrent-neural-networks" title="Link to this heading">#</a></h1>
<hr class="docutils" />
<section id="warming-up">
<h2><span class="section-number">22.1. </span>Warming up<a class="headerlink" href="#warming-up" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># URL of the image from GitHub</span>
<span class="n">img_url2</span> <span class="o">=</span> <span class="s2">&quot;https://github.com/cfteach/NNDL_DATA621/blob/10b57c7be9d3f31989a4f8cca7d21cccbae7754c/DATA621/DATA621/images/Hidden_vs_Output_Recurrence.png&quot;</span>
<span class="c1"># Display the image</span>
<span class="n">Image</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">img_url2</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mi">600</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><img src="https://github.com/cfteach/NNDL_DATA621/blob/10b57c7be9d3f31989a4f8cca7d21cccbae7754c/DATA621/DATA621/images/Hidden_vs_Output_Recurrence.png" width="600"/></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">torch.nn</span> <span class="k">as</span> <span class="nn">nn</span>

<span class="n">torch</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="n">rnn_layer</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">RNN</span><span class="p">(</span><span class="n">input_size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">hidden_size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">num_layers</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">batch_first</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">w_xh</span> <span class="o">=</span> <span class="n">rnn_layer</span><span class="o">.</span><span class="n">weight_ih_l0</span>  <span class="c1">#by default they are initialized randomly</span>
<span class="n">w_hh</span> <span class="o">=</span> <span class="n">rnn_layer</span><span class="o">.</span><span class="n">weight_hh_l0</span>
<span class="n">b_xh</span> <span class="o">=</span> <span class="n">rnn_layer</span><span class="o">.</span><span class="n">bias_ih_l0</span>
<span class="n">b_hh</span> <span class="o">=</span> <span class="n">rnn_layer</span><span class="o">.</span><span class="n">bias_hh_l0</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;W_xh shape:&#39;</span><span class="p">,</span> <span class="n">w_xh</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;W_hh shape:&#39;</span><span class="p">,</span> <span class="n">w_hh</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;b_xh shape:&#39;</span><span class="p">,</span> <span class="n">b_xh</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;b_hh shape:&#39;</span><span class="p">,</span> <span class="n">b_hh</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>W_xh shape: torch.Size([2, 5])
W_hh shape: torch.Size([2, 2])
b_xh shape: torch.Size([2])
b_hh shape: torch.Size([2])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x_seq</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[</span><span class="mf">1.0</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span><span class="p">,</span> <span class="p">[</span><span class="mf">2.0</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span><span class="p">,</span> <span class="p">[</span><span class="mf">3.0</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span><span class="p">])</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">x_seq</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>torch.Size([3, 5])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">w_xh</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Parameter containing:
tensor([[ 0.1622, -0.1683,  0.1939, -0.0361,  0.3021],
        [ 0.1683, -0.0813, -0.5717,  0.1614, -0.6260]], requires_grad=True)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x_seq</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[</span><span class="mf">1.0</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span><span class="p">,</span> <span class="p">[</span><span class="mf">2.0</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span><span class="p">,</span> <span class="p">[</span><span class="mf">3.0</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span><span class="p">])</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>

<span class="c1">## output of the simple RNN:</span>
<span class="n">output</span><span class="p">,</span> <span class="n">hn</span> <span class="o">=</span> <span class="n">rnn_layer</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">x_seq</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)))</span>

<span class="c1"># hn will correspond to the hidden state after the last time step</span>

<span class="c1">#</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Output shape:&#39;</span><span class="p">,</span> <span class="n">output</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Output tensor:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Hidden shape:&#39;</span><span class="p">,</span> <span class="n">hn</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Hidden tensor:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">hn</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1">## manually computing the output:</span>
<span class="n">out_man</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">xt</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">x_seq</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Time step </span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s1"> =&gt;&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   Input           :&#39;</span><span class="p">,</span> <span class="n">xt</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>

    <span class="n">ht</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">xt</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">w_xh</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="n">b_xh</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   Hidden (manual)           :&#39;</span><span class="p">,</span> <span class="n">ht</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
    <span class="c1">#print(&#39;   Hidden (PyTorch)       :&#39;, hn[:, t].detach().numpy())</span>


    <span class="k">if</span> <span class="n">t</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">prev_h</span> <span class="o">=</span> <span class="n">out_man</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">prev_h</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ht</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>

    <span class="n">ot</span> <span class="o">=</span> <span class="n">ht</span> <span class="o">+</span> <span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">prev_h</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">w_hh</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="n">b_hh</span>
    <span class="n">ot</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tanh</span><span class="p">(</span><span class="n">ot</span><span class="p">)</span>
    <span class="n">out_man</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ot</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   </span><span class="se">\033</span><span class="s1">[1mOutput (manual)           :</span><span class="se">\033</span><span class="s1">[0m&#39;</span><span class="p">,</span> <span class="n">ot</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   </span><span class="se">\033</span><span class="s1">[1mRNN Output  (PyTorch)     :</span><span class="se">\033</span><span class="s1">[0m&#39;</span><span class="p">,</span> <span class="n">output</span><span class="p">[:,</span> <span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Output shape: torch.Size([1, 3, 2])
Output tensor:
tensor([[[ 0.6642, -0.7906],
         [ 0.8561, -0.9886],
         [ 0.9403, -0.9987]]], grad_fn=&lt;TransposeBackward1&gt;)

Hidden shape: torch.Size([1, 1, 2])
Hidden tensor:
tensor([[[ 0.9403, -0.9987]]], grad_fn=&lt;StackBackward0&gt;)



Time step 0 =&gt;
   Input           : [[1. 1. 1. 1. 1.]]
   Hidden (manual)           : [[ 0.50097895 -0.6559663 ]]
   <span class=" -Color -Color-Bold">Output (manual)           :</span> [[ 0.6641613 -0.7906304]]
   <span class=" -Color -Color-Bold">RNN Output  (PyTorch)     :</span> [[ 0.6641613 -0.7906304]]

Time step 1 =&gt;
   Input           : [[2. 2. 2. 2. 2.]]
   Hidden (manual)           : [[ 0.9547678 -1.6051545]]
   <span class=" -Color -Color-Bold">Output (manual)           :</span> [[ 0.8561063 -0.9886436]]
   <span class=" -Color -Color-Bold">RNN Output  (PyTorch)     :</span> [[ 0.8561063 -0.9886436]]

Time step 2 =&gt;
   Input           : [[3. 3. 3. 3. 3.]]
   Hidden (manual)           : [[ 1.4085568 -2.5543427]]
   <span class=" -Color -Color-Bold">Output (manual)           :</span> [[ 0.9403312 -0.9987188]]
   <span class=" -Color -Color-Bold">RNN Output  (PyTorch)     :</span> [[ 0.9403312 -0.9987188]]
</pre></div>
</div>
</div>
</div>
</section>
<hr class="docutils" />
<section id="working-with-the-internet-movie-database-imdb">
<h2><span class="section-number">22.2. </span>Working with the Internet Movie Database (IMDb)<a class="headerlink" href="#working-with-the-internet-movie-database-imdb" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">torch.nn</span> <span class="k">as</span> <span class="nn">nn</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">show</span> <span class="n">torch</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Name: torch
Version: 2.5.0+cu121
Summary: Tensors and Dynamic neural networks in Python with strong GPU acceleration
Home-page: https://pytorch.org/
Author: PyTorch Team
Author-email: packages@pytorch.org
License: BSD-3-Clause
Location: /usr/local/lib/python3.10/dist-packages
Requires: filelock, fsspec, jinja2, networkx, sympy, typing-extensions
Required-by: accelerate, fastai, timm, torchaudio, torchvision
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>datasets
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Collecting datasets
  Downloading datasets-3.0.2-py3-none-any.whl.metadata (20 kB)
Requirement already satisfied: filelock in /usr/local/lib/python3.10/dist-packages (from datasets) (3.16.1)
Requirement already satisfied: numpy&gt;=1.17 in /usr/local/lib/python3.10/dist-packages (from datasets) (1.26.4)
Requirement already satisfied: pyarrow&gt;=15.0.0 in /usr/local/lib/python3.10/dist-packages (from datasets) (16.1.0)
Collecting dill&lt;0.3.9,&gt;=0.3.0 (from datasets)
  Downloading dill-0.3.8-py3-none-any.whl.metadata (10 kB)
Requirement already satisfied: pandas in /usr/local/lib/python3.10/dist-packages (from datasets) (2.2.2)
Requirement already satisfied: requests&gt;=2.32.2 in /usr/local/lib/python3.10/dist-packages (from datasets) (2.32.3)
Requirement already satisfied: tqdm&gt;=4.66.3 in /usr/local/lib/python3.10/dist-packages (from datasets) (4.66.5)
Collecting xxhash (from datasets)
  Downloading xxhash-3.5.0-cp310-cp310-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (12 kB)
Collecting multiprocess&lt;0.70.17 (from datasets)
  Downloading multiprocess-0.70.16-py310-none-any.whl.metadata (7.2 kB)
Requirement already satisfied: fsspec&lt;=2024.9.0,&gt;=2023.1.0 in /usr/local/lib/python3.10/dist-packages (from fsspec[http]&lt;=2024.9.0,&gt;=2023.1.0-&gt;datasets) (2024.6.1)
Requirement already satisfied: aiohttp in /usr/local/lib/python3.10/dist-packages (from datasets) (3.10.10)
Requirement already satisfied: huggingface-hub&gt;=0.23.0 in /usr/local/lib/python3.10/dist-packages (from datasets) (0.24.7)
Requirement already satisfied: packaging in /usr/local/lib/python3.10/dist-packages (from datasets) (24.1)
Requirement already satisfied: pyyaml&gt;=5.1 in /usr/local/lib/python3.10/dist-packages (from datasets) (6.0.2)
Requirement already satisfied: aiohappyeyeballs&gt;=2.3.0 in /usr/local/lib/python3.10/dist-packages (from aiohttp-&gt;datasets) (2.4.3)
Requirement already satisfied: aiosignal&gt;=1.1.2 in /usr/local/lib/python3.10/dist-packages (from aiohttp-&gt;datasets) (1.3.1)
Requirement already satisfied: attrs&gt;=17.3.0 in /usr/local/lib/python3.10/dist-packages (from aiohttp-&gt;datasets) (24.2.0)
Requirement already satisfied: frozenlist&gt;=1.1.1 in /usr/local/lib/python3.10/dist-packages (from aiohttp-&gt;datasets) (1.4.1)
Requirement already satisfied: multidict&lt;7.0,&gt;=4.5 in /usr/local/lib/python3.10/dist-packages (from aiohttp-&gt;datasets) (6.1.0)
Requirement already satisfied: yarl&lt;2.0,&gt;=1.12.0 in /usr/local/lib/python3.10/dist-packages (from aiohttp-&gt;datasets) (1.16.0)
Requirement already satisfied: async-timeout&lt;5.0,&gt;=4.0 in /usr/local/lib/python3.10/dist-packages (from aiohttp-&gt;datasets) (4.0.3)
Requirement already satisfied: typing-extensions&gt;=3.7.4.3 in /usr/local/lib/python3.10/dist-packages (from huggingface-hub&gt;=0.23.0-&gt;datasets) (4.12.2)
Requirement already satisfied: charset-normalizer&lt;4,&gt;=2 in /usr/local/lib/python3.10/dist-packages (from requests&gt;=2.32.2-&gt;datasets) (3.4.0)
Requirement already satisfied: idna&lt;4,&gt;=2.5 in /usr/local/lib/python3.10/dist-packages (from requests&gt;=2.32.2-&gt;datasets) (3.10)
Requirement already satisfied: urllib3&lt;3,&gt;=1.21.1 in /usr/local/lib/python3.10/dist-packages (from requests&gt;=2.32.2-&gt;datasets) (2.2.3)
Requirement already satisfied: certifi&gt;=2017.4.17 in /usr/local/lib/python3.10/dist-packages (from requests&gt;=2.32.2-&gt;datasets) (2024.8.30)
Requirement already satisfied: python-dateutil&gt;=2.8.2 in /usr/local/lib/python3.10/dist-packages (from pandas-&gt;datasets) (2.8.2)
Requirement already satisfied: pytz&gt;=2020.1 in /usr/local/lib/python3.10/dist-packages (from pandas-&gt;datasets) (2024.2)
Requirement already satisfied: tzdata&gt;=2022.7 in /usr/local/lib/python3.10/dist-packages (from pandas-&gt;datasets) (2024.2)
Requirement already satisfied: six&gt;=1.5 in /usr/local/lib/python3.10/dist-packages (from python-dateutil&gt;=2.8.2-&gt;pandas-&gt;datasets) (1.16.0)
Requirement already satisfied: propcache&gt;=0.2.0 in /usr/local/lib/python3.10/dist-packages (from yarl&lt;2.0,&gt;=1.12.0-&gt;aiohttp-&gt;datasets) (0.2.0)
Downloading datasets-3.0.2-py3-none-any.whl (472 kB)
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class=" -Color -Color-Green">472.7/472.7 kB</span> <span class=" -Color -Color-Red">13.1 MB/s</span> eta <span class=" -Color -Color-Cyan">0:00:00</span>
?25hDownloading dill-0.3.8-py3-none-any.whl (116 kB)
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class=" -Color -Color-Green">116.3/116.3 kB</span> <span class=" -Color -Color-Red">10.4 MB/s</span> eta <span class=" -Color -Color-Cyan">0:00:00</span>
?25hDownloading multiprocess-0.70.16-py310-none-any.whl (134 kB)
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class=" -Color -Color-Green">134.8/134.8 kB</span> <span class=" -Color -Color-Red">10.6 MB/s</span> eta <span class=" -Color -Color-Cyan">0:00:00</span>
?25hDownloading xxhash-3.5.0-cp310-cp310-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (194 kB)
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class=" -Color -Color-Green">194.1/194.1 kB</span> <span class=" -Color -Color-Red">14.7 MB/s</span> eta <span class=" -Color -Color-Cyan">0:00:00</span>
?25hInstalling collected packages: xxhash, dill, multiprocess, datasets
Successfully installed datasets-3.0.2 dill-0.3.8 multiprocess-0.70.16 xxhash-3.5.0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datasets</span> <span class="kn">import</span> <span class="n">load_dataset</span>
<span class="kn">from</span> <span class="nn">torch.utils.data</span> <span class="kn">import</span> <span class="n">Dataset</span><span class="p">,</span> <span class="n">random_split</span><span class="p">,</span> <span class="n">DataLoader</span>
<span class="kn">import</span> <span class="nn">torch</span>

<span class="c1"># Step 1: Load the IMDB dataset from Hugging Face</span>
<span class="n">imdb</span> <span class="o">=</span> <span class="n">load_dataset</span><span class="p">(</span><span class="s2">&quot;imdb&quot;</span><span class="p">)</span>

<span class="c1"># Step 2: Create a PyTorch Dataset wrapper</span>
<span class="k">class</span> <span class="nc">IMDBDataset</span><span class="p">(</span><span class="n">Dataset</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hf_dataset</span><span class="p">):</span>
        <span class="c1"># Hugging Face dataset is passed as an argument</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">hf_dataset</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="c1"># Return the text and the label for each item</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="s1">&#39;text&#39;</span><span class="p">],</span>
            <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>
        <span class="p">}</span>

<span class="c1"># Step 3: Wrap Hugging Face datasets into PyTorch-compatible Datasets</span>
<span class="n">train_dataset</span> <span class="o">=</span> <span class="n">IMDBDataset</span><span class="p">(</span><span class="n">imdb</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">])</span>
<span class="n">test_dataset</span> <span class="o">=</span> <span class="n">IMDBDataset</span><span class="p">(</span><span class="n">imdb</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">])</span>

<span class="c1"># Step 4: Split the train dataset into train and validation sets using random_split</span>
<span class="n">torch</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># For reproducibility</span>

<span class="c1"># You want 20,000 for training and 5,000 for validation</span>
<span class="n">train_dataset</span><span class="p">,</span> <span class="n">valid_dataset</span> <span class="o">=</span> <span class="n">random_split</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">,</span> <span class="p">[</span><span class="mi">20000</span><span class="p">,</span> <span class="mi">5000</span><span class="p">])</span>

<span class="c1"># Step 5: Create DataLoader for each dataset (including the test dataset)</span>
<span class="n">train_loader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">valid_loader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">valid_dataset</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">test_loader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">test_dataset</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># No shuffling for test data</span>

<span class="c1"># Step 6: Example of iterating over a test_loader batch</span>
<span class="k">for</span> <span class="n">batch</span> <span class="ow">in</span> <span class="n">test_loader</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">batch</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">],</span> <span class="n">batch</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">])</span>  <span class="c1"># Access text and labels from the test set</span>
    <span class="k">break</span>  <span class="c1"># Print just one batch as an example</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/usr/local/lib/python3.10/dist-packages/huggingface_hub/utils/_token.py:89: UserWarning: 
The secret `HF_TOKEN` does not exist in your Colab secrets.
To authenticate with the Hugging Face Hub, create a token in your settings tab (https://huggingface.co/settings/tokens), set it as secret in your Google Colab and restart your session.
You will be able to reuse this secret in all of your notebooks.
Please note that authentication is recommended but still optional to access public models or datasets.
  warnings.warn(
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "6438eaa3000a401cb9f349efec73c538"}</script><script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "2e3d80ac40ab4a9fa6a6220b53d1f397"}</script><script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "f26552bc1ace4feb8b9543c12b1b5286"}</script><script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "d418994e09414214a5b4e008453bafba"}</script><script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "4011ec47f9944e47913c5ef7dfaff844"}</script><script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "3205be6ce0e84431b629461dece95476"}</script><script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "86ee15306fb74a96bb33777f2f46de58"}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;I love sci-fi and am willing to put up with a lot. Sci-fi movies/TV are usually underfunded, under-appreciated and misunderstood. I tried to like this, I really did, but it is to good TV sci-fi as Babylon 5 is to Star Trek (the original). Silly prosthetics, cheap cardboard sets, stilted dialogues, CG that doesn\&#39;t match the background, and painfully one-dimensional characters cannot be overcome with a \&#39;sci-fi\&#39; setting. (I\&#39;m sure there are those of you out there who think Babylon 5 is good sci-fi TV. It\&#39;s not. It\&#39;s clichéd and uninspiring.) While US viewers might like emotion and character development, sci-fi is a genre that does not take itself seriously (cf. Star Trek). It may treat important issues, yet not as a serious philosophy. It\&#39;s really difficult to care about the characters here as they are not simply foolish, just missing a spark of life. Their actions and reactions are wooden and predictable, often painful to watch. The makers of Earth KNOW it\&#39;s rubbish as they have to always say &quot;Gene Roddenberry\&#39;s Earth...&quot; otherwise people would not continue watching. Roddenberry\&#39;s ashes must be turning in their orbit as this dull, cheap, poorly edited (watching it without advert breaks really brings this home) trudging Trabant of a show lumbers into space. Spoiler. So, kill off a main character. And then bring him back as another actor. Jeeez! Dallas all over again.&#39;, &quot;Worth the entertainment value of a rental, especially if you like action movies. This one features the usual car chases, fights with the great Van Damme kick style, shooting battles with the 40 shell load shotgun, and even terrorist style bombs. All of this is entertaining and competently handled but there is nothing that really blows you away if you&#39;ve seen your share before.&lt;br /&gt;&lt;br /&gt;The plot is made interesting by the inclusion of a rabbit, which is clever but hardly profound. Many of the characters are heavily stereotyped -- the angry veterans, the terrified illegal aliens, the crooked cops, the indifferent feds, the bitchy tough lady station head, the crooked politician, the fat federale who looks like he was typecast as the Mexican in a Hollywood movie from the 1940s. All passably acted but again nothing special.&lt;br /&gt;&lt;br /&gt;I thought the main villains were pretty well done and fairly well acted. By the end of the movie you certainly knew who the good guys were and weren&#39;t. There was an emotional lift as the really bad ones got their just deserts. Very simplistic, but then you weren&#39;t expecting Hamlet, right? The only thing I found really annoying was the constant cuts to VDs daughter during the last fight scene.&lt;br /&gt;&lt;br /&gt;Not bad. Not good. Passable 4.&quot;, &quot;its a totally average film with a few semi-alright action sequences that make the plot seem a little better and remind the viewer of the classic van dam films. parts of the plot don&#39;t make sense and seem to be added in to use up time. the end plot is that of a very basic type that doesn&#39;t leave the viewer guessing and any twists are obvious from the beginning. the end scene with the flask backs don&#39;t make sense as they are added in and seem to have little relevance to the history of van dam&#39;s character. not really worth watching again, bit disappointed in the end production, even though it is apparent it was shot on a low budget certain shots and sections in the film are of poor directed quality&quot;, &quot;STAR RATING: ***** Saturday Night **** Friday Night *** Friday Morning ** Sunday Night * Monday Morning &lt;br /&gt;&lt;br /&gt;Former New Orleans homicide cop Jack Robideaux (Jean Claude Van Damme) is re-assigned to Columbus, a small but violent town in Mexico to help the police there with their efforts to stop a major heroin smuggling operation into their town. The culprits turn out to be ex-military, lead by former commander Benjamin Meyers (Stephen Lord, otherwise known as Jase from East Enders) who is using a special method he learned in Afghanistan to fight off his opponents. But Jack has a more personal reason for taking him down, that draws the two men into an explosive final showdown where only one will walk away alive.&lt;br /&gt;&lt;br /&gt;After Until Death, Van Damme appeared to be on a high, showing he could make the best straight to video films in the action market. While that was a far more drama oriented film, with The Shepherd he has returned to the high-kicking, no brainer action that first made him famous and has sadly produced his worst film since Derailed. It&#39;s nowhere near as bad as that film, but what I said still stands.&lt;br /&gt;&lt;br /&gt;A dull, predictable film, with very little in the way of any exciting action. What little there is mainly consists of some limp fight scenes, trying to look cool and trendy with some cheap slo-mo/sped up effects added to them that sadly instead make them look more desperate. Being a Mexican set film, director Isaac Florentine has tried to give the film a Robert Rodriguez/Desperado sort of feel, but this only adds to the desperation.&lt;br /&gt;&lt;br /&gt;VD gives a particularly uninspired performance and given he&#39;s never been a Robert De Niro sort of actor, that can&#39;t be good. As the villain, Lord shouldn&#39;t expect to leave the beeb anytime soon. He gets little dialogue at the beginning as he struggles to muster an American accent but gets mysteriously better towards the end. All the supporting cast are equally bland, and do nothing to raise the films spirits at all.&lt;br /&gt;&lt;br /&gt;This is one shepherd that&#39;s strayed right from the flock. *&quot;, &quot;First off let me say, If you haven&#39;t enjoyed a Van Damme movie since bloodsport, you probably will not like this movie. Most of these movies may not have the best plots or best actors but I enjoy these kinds of movies for what they are. This movie is much better than any of the movies the other action guys (Segal and Dolph) have thought about putting out the past few years. Van Damme is good in the movie, the movie is only worth watching to Van Damme fans. It is not as good as Wake of Death (which i highly recommend to anyone of likes Van Damme) or In hell but, in my opinion it&#39;s worth watching. It has the same type of feel to it as Nowhere to Run. Good fun stuff!&quot;, &quot;I had high hopes for this one until they changed the name to &#39;The Shepherd : Border Patrol, the lamest movie name ever, what was wrong with just &#39;The Shepherd&#39;. This is a by the numbers action flick that tips its hat at many classic Van Damme films. There is a nice bit of action in a bar which reminded me of hard target and universal soldier but directed with no intensity or flair which is a shame. There is one great line about &#39;being p*ss drunk and carrying a rabbit&#39; and some OK action scenes let down by the cheapness of it all. A lot of the times the dialogue doesn&#39;t match the characters mouth and the stunt men fall down dead a split second before even being shot. The end fight is one of the better Van Damme fights except the Director tries to go a bit too John Woo and fails also introducing flashbacks which no one really cares about just gets in the way of the action which is the whole point of a van Damme film.&lt;br /&gt;&lt;br /&gt;Not good, not bad, just average generic action.&quot;, &quot;Isaac Florentine has made some of the best western Martial Arts action movies ever produced. In particular US Seals 2, Cold Harvest, Special Forces and Undisputed 2 are all action classics. You can tell Isaac has a real passion for the genre and his films are always eventful, creative and sharp affairs, with some of the best fight sequences an action fan could hope for. In particular he has found a muse with Scott Adkins, as talented an actor and action performer as you could hope for. This is borne out with Special Forces and Undisputed 2, but unfortunately The Shepherd just doesn&#39;t live up to their abilities.&lt;br /&gt;&lt;br /&gt;There is no doubt that JCVD looks better here fight-wise than he has done in years, especially in the fight he has (for pretty much no reason) in a prison cell, and in the final showdown with Scott, but look in his eyes. JCVD seems to be dead inside. There&#39;s nothing in his eyes at all. It&#39;s like he just doesn&#39;t care about anything throughout the whole film. And this is the leading man.&lt;br /&gt;&lt;br /&gt;There are other dodgy aspects to the film, script-wise and visually, but the main problem is that you are utterly unable to empathise with the hero of the film. A genuine shame as I know we all wanted this film to be as special as it genuinely could have been. There are some good bits, mostly the action scenes themselves. This film had a terrific director and action choreographer, and an awesome opponent for JCVD to face down. This could have been the one to bring the veteran action star back up to scratch in the balls-out action movie stakes.&lt;br /&gt;&lt;br /&gt;Sincerely a shame that this didn&#39;t happen.&quot;, &quot;It actually pains me to say it, but this movie was horrible on every level. The blame does not lie entirely with Van Damme as you can see he tried his best, but let&#39;s face it, he&#39;s almost fifty, how much more can you ask of him? I find it so hard to believe that the same people who put together Undisputed 2; arguably the best (western) martial arts movie in years, created this. Everything from the plot, to the dialog, to the editing, to the overall acting was just horribly put together and in many cases outright boring and nonsensical. Scott Adkins who&#39;s fight scenes seemed more like a demo reel, was also terribly underused and not even the main villain which is such a shame because 1) He is more than capable of playing that role and 2) The actual main villain was not only not intimidating at all but also quite annoying. Again, not blaming Van Damme. I will always be a fan, but avoid this one.&quot;, &quot;Technically I&#39;am a Van Damme Fan, or I was. this movie is so bad that I hated myself for wasting those 90 minutes. Do not let the name Isaac Florentine (Undisputed II) fool you, I had big hopes for this one, depending on what I saw in (Undisputed II), man.. was I wrong ??! all action fans wanted a big comeback for the classic action hero, but i guess we wont be able to see that soon, as our hero keep coming with those (going -to-a-border - far-away-town-and -kill -the-bad-guys- than-comeback- home) movies I mean for God&#39;s sake, we are in 2008, and they insist on doing those disappointing movies on every level. Why ??!!! Do your self a favor, skip it.. seriously.&quot;, &#39;Honestly awful film, bad editing, awful lighting, dire dialog and scrappy screenplay.&lt;br /&gt;&lt;br /&gt;The lighting at is so bad there\&#39;s moments you can\&#39;t even see what\&#39;s going on, I even tried to playing with the contrast and brightness so I could see something but that didn\&#39;t help.&lt;br /&gt;&lt;br /&gt;They must have found the script in a bin, the character development is just as awful and while you hardly expect much from a Jean-Claude Van Damme film this one manages to hit an all time low. You can\&#39;t even laugh at the cheesy\&#39;ness.&lt;br /&gt;&lt;br /&gt;The directing and editing are also terrible, the whole film follows an extremely tired routine and fails at every turn as it bumbles through the plot that is so weak it\&#39;s just unreal.&lt;br /&gt;&lt;br /&gt;There\&#39;s not a lot else to say other than it\&#39;s really bad and nothing like Jean-Claude Van Damme\&#39;s earlier work which you could enjoy.&lt;br /&gt;&lt;br /&gt;Avoid like the plaque, frankly words fail me in condemning this &quot;film&quot;.&#39;, &#39;This flick is a waste of time.I expect from an action movie to have more than 2 explosions and some shooting.Van Damme\&#39;s acting is awful. He never was much of an actor, but here it is worse.He was definitely better in his earlier movies. His screenplay part for the whole movie was probably not more than one page of stupid nonsense one liners.The whole dialog in the film is a disaster, same as the plot.The title &quot;The Shepherd&quot; makes no sense. Why didn\&#39;t they just call it &quot;Border patrol&quot;? The fighting scenes could have been better, but either they weren\&#39;t able to afford it, or the fighting choreographer was suffering from lack of ideas.This is a cheap low type of action cinema.&#39;, &quot;Blind Date (Columbia Pictures, 1934), was a decent film, but I have a few issues with this film. First of all, I don&#39;t fault the actors in this film at all, but more or less, I have a problem with the script. Also, I understand that this film was made in the 1930&#39;s and people were looking to escape reality, but the script made Ann Sothern&#39;s character look weak. She kept going back and forth between suitors and I felt as though she should have stayed with Paul Kelly&#39;s character in the end. He truly did care about her and her family and would have done anything for her and he did by giving her up in the end to fickle Neil Hamilton who in my opinion was only out for a good time. Paul Kelly&#39;s character, although a workaholic was a man of integrity and truly loved Kitty (Ann Sothern) as opposed to Neil Hamilton, while he did like her a lot, I didn&#39;t see the depth of love that he had for her character. The production values were great, but the script could have used a little work.&quot;, &#39;I first watched this movie back in the mid/late 80\&#39;s, when I was a kid. We couldn\&#39;t even get all the way through it. The dialog, the acting, everything about it was just beyond lame.&lt;br /&gt;&lt;br /&gt;Here are a few examples... imagine these spoken real dramatically, way over-acted: &quot;Oreegon? You\&#39;re going to Oreegon? Why would anyone want to go to Oreegon?&quot;&lt;br /&gt;&lt;br /&gt;&quot;Survivalists? Nobody ever told us about any survivalists!&quot;&lt;br /&gt;&lt;br /&gt;This movie was SO bad, my sister and I rented it again for her 16th birthday party, just so our friends could sit around and laugh at how awful it was. I don\&#39;t think we were able to finish it then either!&#39;, &#39;I saw the Mogul Video VHS of this. That\&#39;s another one of those old 1980s distributors whose catalog I wish I had!&lt;br /&gt;&lt;br /&gt;This movie was pretty poor. Though retitled &quot;Don\&#39;t Look in the Attic,&quot; the main admonition that is repeated in this is &quot;Don\&#39;t go to the villa.&quot; Just getting on the grounds of the villa is a bad idea. A character doesn\&#39;t go into the attic until an hour into the movie, and actually should have done it earlier because of what is learned there.&lt;br /&gt;&lt;br /&gt;The movie starts in Turin, Italy in the 1950s. Two men are fighting, and a woman is telling them the villa is making them do it. One man kills the other, then regrets it, and the woman pulls out the knife and stabs him with it. She flees the villa, and after she\&#39;s left a chair moves by itself (what\&#39;s the point of that?), but when in the garden a hand comes up through the ground and drags he into the earth.&lt;br /&gt;&lt;br /&gt;From there, it\&#39;s the present day, thirty years later. There\&#39;s a séance that appears suddenly and doesn\&#39;t appear to have anything to do with the movie. The children of the woman from the prologue are inheriting the house. The main daughter is played by the same actress who played her mother. At least one of the two men from the prologue seems to reoccur as another character too. She\&#39;s haunted by some warnings not to go to the villa, but they all do, since if they do not use it, they forfeit it. People die. A lawyer who has won all his cases tries to investigate a little. The ending is pretty poor. Why was the family cursed? An unfortunately boring movie.&lt;br /&gt;&lt;br /&gt;There\&#39;s an amusing small-print disclaimer on the back of the video box that reads &quot;The scenes depicted on this packaging may be an artist\&#39;s impression and may not necessarily represent actual scenes from the film.&quot; In this case, the cover of the box is an illustration that does more or less accurately depict the aforementioned woman dragged underground scene, although there are two hands, and the woman is different. It\&#39;s true, sometimes the cover art has nothing to do with the movie. I also recall seeing a reviewer who had a bad movie predictor scale, in which movies with illustrations on the cover instead of photos got at least one point for that.&#39;, &quot;A group of heirs to a mysterious old mansion find out that they have to live in it as part of a clause in the will or be disinherited, but they soon find out of its history of everybody whom had lived there before them having either died in weird accidents or having had killed each other.&lt;br /&gt;&lt;br /&gt;You&#39;ve seen it all before, and this one is too low-budget and slow paced to be scary, and doesn&#39;t have any real surprises in the climax. No special effects or gore to speak of, in fact the only really amusing thing about the whole film is the quality of the English dubbing, which at times is as bad as a cheap martial arts movie.&lt;br /&gt;&lt;br /&gt;3 out of 10, pretty low in the pecking order of 80&#39;s haunted house movies.&quot;, &#39;Now, I LOVE Italian horror films. The cheesier they are, the better. However, this is not cheesy Italian. This is week-old spaghetti sauce with rotting meatballs. It is amateur hour on every level. There is no suspense, no horror, with just a few drops of blood scattered around to remind you that you are in fact watching a horror film. The &quot;special effects&quot; consist of the lights changing to red whenever the ghost (or whatever it was supposed to be) is around, and a string pulling bed sheets up and down. Oooh, can you feel the chills? The DVD quality is that of a VHS transfer (which actually helps the film more than hurts it). The dubbing is below even the lowest &quot;bad Italian movie&quot; standards and I gave it one star just because the dialogue is so hilarious! And what do we discover when she finally DOES look in the attic (in a scene that is daytime one minute and night the next)...well, I won\&#39;t spoil it for anyone who really wants to see, but let\&#39;s just say that it isn\&#39;t very &quot;novel&quot;!&#39;, &quot;This cheap, grainy-filmed Italian flick is about a couple of inheritors of a manor in the Italian countryside who head up to the house to stay, and then find themselves getting killed off by ghosts of people killed in that house.&lt;br /&gt;&lt;br /&gt;I wasn&#39;t impressed by this. It wasn&#39;t really that scary, mostly just the way a cheap Italian film should be. A girl, her two cousins, and one cousin&#39;s girlfriend, head to this huge house for some reason (I couldn&#39;t figure out why) and are staying there, cleaning up and checking out the place. Characters come in and out of the film, and it&#39;s quite boring at points, and the majority of deaths are quite rushed. The girlfriend is hit by a car when fleeing the house after having a dream of her death, and the scene is quite good, but then things get slow again, until a confusing end, when the male cousins are killed together in some weird way, and this weirdo guy (I couldn&#39;t figure out who he was during the movie, or maybe I just don&#39;t remember) goes after this one girl, attacking her, until finally this other girl kills him off. Hate to give away the ending, but oh well. The female cousin decides to stay at the house and watch over it, and they show scenes of her living there years later. The end. You really aren&#39;t missing anything, and anyway, you probably won&#39;t find this anywhere, so lucky you.&quot;, &quot;I just finished watching this movie and am disappointed to say that I didn&#39;t enjoy it a bit. It is so slow Slow and uninteresting. This kid from Harry Potter plays a shy teenager with an rude mother, and then one day the rude mother tells the kid to find a job so that they could accommodate an old guy apparently having no place to live has started to live with his family and therefore the kid goes to work for a old lady. And this old lady who is living all alone teaches him about girls, driving car and life! I couldn&#39;t get how an 18 year old guy enjoy spending time with an awful lady in her 80s. Sorry if my comments on this movie has bothered people who might have enjoyed it, I could be wrong as I am not British and may not understand the social and their family structure and way of life. Mostly the movie is made for the British audience.&quot;, &quot;Ben, (Rupert Grint), is a deeply unhappy adolescent, the son of his unhappily married parents. His father, (Nicholas Farrell), is a vicar and his mother, (Laura Linney), is ... well, let&#39;s just say she&#39;s a somewhat hypocritical soldier in Jesus&#39; army. It&#39;s only when he takes a summer job as an assistant to a foul-mouthed, eccentric, once-famous and now-forgotten actress Evie Walton, (Julie Walters), that he finally finds himself in true &#39;Harold and Maude&#39; fashion. Of course, Evie is deeply unhappy herself and it&#39;s only when these two sad sacks find each other that they can put their mutual misery aside and hit the road to happiness.&lt;br /&gt;&lt;br /&gt;Of course it&#39;s corny and sentimental and very predictable but it has a hard side to it, too and Walters, who could sleep-walk her way through this sort of thing if she wanted, is excellent. It&#39;s when she puts the craziness to one side and finds the pathos in the character, (like hitting the bottle and throwing up in the sink), that she&#39;s at her best. The problem is she&#39;s the only interesting character in the film (and it&#39;s not because of the script which doesn&#39;t do anybody any favours). Grint, on the other hand, isn&#39;t just unhappy; he&#39;s a bit of a bore as well while Linney&#39;s starched bitch is completely one-dimensional. (Still, she&#39;s got the English accent off pat). The best that can be said for it is that it&#39;s mildly enjoyable - with the emphasis on the mildly.&quot;, &#39;Every movie I have PPV\&#39;d because Leonard Maltin praised it to the skies has blown chunks! Every single one! When will I ever learn?&lt;br /&gt;&lt;br /&gt;Evie is a raving Old Bag who thinks nothing of saying she\&#39;s dying of breast cancer to get her way! Laura is an insufferable Medusa filled with The Holy Spirit (and her hubby\&#39;s protégé)! Caught between these harpies is Medusa\&#39;s dumb-as-a-rock boy who has been pressed into weed-pulling servitude by The Old Bag!&lt;br /&gt;&lt;br /&gt;As I said, when will I ever learn?&lt;br /&gt;&lt;br /&gt;I was temporarily lifted out of my malaise when The Old Bag stuck her head in a sink, but, unfortunately, she did not die. I was temporarily lifted out of my malaise again when Medusa got mowed down, but, unfortunately, she did not die. It should be a capital offense to torture audiences like this!&lt;br /&gt;&lt;br /&gt;Without Harry Potter to kick him around, Rupert Grint is just a pair of big blue eyes that practically bulge out of its sockets. Julie Walters\&#39;s scenery-chewing (especially the scene when she &quot;plays&quot; God) is even more shameless than her character.&lt;br /&gt;&lt;br /&gt;At least this Harold bangs some bimbo instead of Maude. For that, I am truly grateful. And if you\&#39;re reading this Mr. Maltin, you owe me $3.99!&#39;, &quot;Low budget horror movie. If you don&#39;t raise your expectations too high, you&#39;ll probably enjoy this little flick. Beginning and end are pretty good, middle drags at times and seems to go nowhere for long periods as we watch the goings on of the insane that add atmosphere but do not advance the plot. Quite a bit of gore. I enjoyed Bill McGhee&#39;s performance which he made quite believable for such a low budget picture, he managed to carry the movie at times when nothing much seemed to be happening. Nurse Charlotte Beale, played by Jesse Lee, played her character well so be prepared to want to slap her toward the end! She makes some really stupid mistakes but then, that&#39;s what makes these low budget movies so good! I would have been out of that place and five states away long before she even considered that it might be a good idea to leave! If you enjoy this movie, try Committed from 1988 which is basically a rip off of this movie.&quot;, &quot;Dr Stephens (Micheal Harvey) runs a mental asylum. He has a different approach to the insane. He conducts unorthodox methods of treatment. He treats everyone like family, there are no locks on the patients doors and he lets some of the inmates act out their twisted fantasies. He lets Sergeant Jaffee (Hugh Feagin) dress and act as a soldier and Harriet (Camilla Carr) be a mother to a doll, including letting her put it to bed in a cot. Dr. Stevens is outside letting Judge Oliver W. Cameron (Gene Ross) chop a log up with an axe, it turns out to be a bad move as once Dr. Stevens back is turned the Judge plants the axe in his shoulder. Soon after Nurse Charlotte Beale (Rosie Holotik) arrives at the Sanitarium having arranged an interview with Dr. Stevens about a possible job. She is met by the head Nurse, Geraldine Masters (Annabelle Weenick as Anne McAdams) and is offered a trail position. She gets to know and becomes well liked among the patients. However things eventually start to turn sour, the phone lines are cut, an old lady named Mrs. Callingham (Rhea MacAdams) has her tongue cut out and she starts to get a strange feeling that things just aren&#39;t right somehow. Then, one night all the Sanitariums dark secrets are violently revealed. Produced and directed by S.f. Brownrigg this film has a great central idea which builds into a cool twist ending, but ultimately is a bit of a chore to sit through because of it&#39;s low budget restrictions and a rather slow script by Tim Pope. There are just too many long boring stretches of dialogue by the inmates, not a lot really happens until the final twenty odd minutes. The film has no real visual quality as it&#39;s set entirely in the Sanitarium and it&#39;s grounds which is basically just a big bland house in the middle of nowhere. There&#39;s no graphic gore in it, a few splashes of blood here and there and thats yer lot. There&#39;s a bit of nudity, but like the gore not much. The acting is pretty strong, especially Holotik and Weenick. The photography is flat and unexciting and I can&#39;t even remember what the music was like. The twist ending is great, but it just takes far too long to get to it. A film that had a lot of potential that was probably held back by it&#39;s budget. OK I guess, but I think it would have worked a lot better if the story had been turned into a half an hour &#39;Tales form the Crypt&#39; episode.&quot;, &quot;The Forgotten (AKA: Don&#39;t Look In The Basement) is a very cheaply made and very old looking horror movie.&lt;br /&gt;&lt;br /&gt;The story is very slow and never really reaches anything worth getting excited about.&lt;br /&gt;&lt;br /&gt;The patients at the asylum are embarrassingly funny especially Sam and the old woman who always quotes an old saying to everyone. (Look out for the bit when she gets close to the camera, tell me you can watch without laughing!).&lt;br /&gt;&lt;br /&gt;Now the gore is very poor looking, with the blood looking pink in many scenes so it doesn&#39;t really deserve its place on the video nasties list!.&lt;br /&gt;&lt;br /&gt;Overall if you aren&#39;t looking for a fantastic horror film and have some time to spare then it&#39;s worth a watch.&quot;, &#39;This movie had a very unique effect on me: it stalled my realization that this movie REALLY sucks! It is disguised as a &quot;thinker\&#39;s film&quot; in the likes of Memento and other jewels like that, but at the end, and even after a few minutes, you come to realize that this is nothing but utter pretentious cr4p. Probably written by some collage student with friends to compassionate to tell him that his writing sucks. The whole idea is \x85 I don\&#39;t even know if it tried to scratch on the supernatural, or they want us to believe that because someone fills your mind (a very weak one, btw) with stupid &quot;riddles&quot;, the kind you learn on elementary school recess, you suddenly come to the &quot;one truth&quot; about everything, then you have to kill someone and confess\x85. !!! What? How, what, why, WHY? Is just like saying that to make a cake, just throw a bunch of ingredients, and add water\x85 forgot about cooking it? I guess these guys forgot to, not explain, but present the mechanism of WHY was this happening? You have to do that when you present a story which normal, everyday acts (lie solving riddle rhymes) start to have an abnormal effect on people. Acting was horrible, with that girl always trying to look cute at the camera, and the guy from Highlanders, the series, acting up like the though heavy metal record store (yeah, they\&#39;re all real though s-o-b\&#39;s). The &quot;menacing&quot; atmosphere, with the &quot;oh-so-clever&quot; riddles (enter the 60\&#39;s series of Batman and Robin, with guest appearance of The Riddle) and the crazies who claim to have &quot;the knowledge&quot; behind that smirk on their faces\x85 just horrible, HORRIBLE.&lt;br /&gt;&lt;br /&gt;I\&#39;m usually very partial about low budget movies, and tend to root for the underdog by giving them more praise than they may deserve, in lieu of their constrictions, you know, but this is just an ugly excuse for a movie that will keep you wanting to be good for an hour and a half, and at the end you will just lament that you fell for it.&#39;, &#39;too bad this movie isn\&#39;t. While &quot;Nemesis Game&quot; is mildly entertaining, I found it hard to suspend my disbelief the whole length of the movie, especially the situations that Sara was putting herself into. Are we supposed to believe that:&lt;br /&gt;&lt;br /&gt;1) this hot chick is going to go slumming unarmed around abandoned buildings and dark subway tunnels in the middle of the night just to solve some riddles?&lt;br /&gt;&lt;br /&gt;2) the protagonists are supposedly such experts that they play riddle games for fun, but don\&#39;t put the whole &quot;I Never Sinned&quot; riddle together until the very end...and then...and then...get this...she has to do the whole mirror thing to finally put the pieces together?? I know it was the filmmaker\&#39;s device to show the audience what was going on, but do they really think we\&#39;re that stupid?&lt;br /&gt;&lt;br /&gt;3) when Vern and Sara go to the Chez M to question the blonde, there is not ONE topless chick in the whole building. Nada. C\&#39;mon. I know it\&#39;s Canada, but I would expect more from a country that gave us Shannon Tweed.&lt;br /&gt;&lt;br /&gt;And anyone else notice that when Vern was surfing the Web and found that riddlezone site, that when he moused over the link the cursor stayed an arrow, and didn\&#39;t turn into a little hand (LIKE ALL CURSORS DO WHEN YOU CLICK ON A HYPERLINK)?!? I mean, if you\&#39;re gonna have the internet play such a prominent role in your movie, at least get the little things right. Geez.&#39;, &#39;I of course saw the previews for this at the beginning of some other Lion\&#39;s Gate extravaganza, so of course it was only the best parts and therefore looked intriguing. And it is, to a point. A young college student (Sarah)is finding riddles all over the place and is becoming obsessed with answering them, and in doing so she\&#39;s unwittingly becoming involved in some game. Now that\&#39;s fairly intriguing right there but unfortunately it all gets rather muddled and becomes so complicated that the viewer (like myself) will most likely become frustrated. Characters appear with little introduction and you\&#39;re not really sure who they are or why Sarah knows them or is hanging out with them. All of this has something to do with this woman who tried to drown a young boy years ago and her reason for that was that it\&#39;s &quot;all part of the design&quot;. In reality, it\&#39;s all part of the &quot;very sketchy script&quot; and when the film is over you\&#39;ll find yourself feeling that you\&#39;ve lost about an hour and a half of your life that you want back for more productive uses of your time, like cleaning the bathroom, for instance. 4 out of 10.&#39;, &quot;I gave this a 3 out of a possible 10 stars.&lt;br /&gt;&lt;br /&gt;Unless you like wasting your time watching an anorexic actress, in this film it&#39;s Carly Pope, behaving like a ditz, don&#39;t bother.&lt;br /&gt;&lt;br /&gt;Carly Pope plays Sara Novak, a young college student, who becomes intrigued with a game of riddles, that leads her down into subway tunnels underneath the city - a dangerous thing for even a well-armed man to go in alone.&lt;br /&gt;&lt;br /&gt;There are various intrigues in the film -- a weirdo classmate who is apparently stalking Sara, a cynical shopkeeper who runs some kind of offbeat hole-in-the-wall establishment that appears to be located in the back alley of a ghetto, a nerdish dim-wit that hangs around the cynic&#39;s shop, and a woman named Emily Gray, who is back in prison.&lt;br /&gt;&lt;br /&gt;Sara&#39;s father is a lawyer who is handling Emily Gray&#39;s case. &lt;br /&gt;&lt;br /&gt;A few years back, Emily Gray attempted to drown a 12 year old boy. Emily was put in a mental hospital for 5 years, and for some cockeyed reason they let her out again, even though it is obvious she is still dangerously deranged.&lt;br /&gt;&lt;br /&gt;The only explanation Emily has ever given for her crime is: I never sinned.&lt;br /&gt;&lt;br /&gt;It&#39;s all part of the design.&lt;br /&gt;&lt;br /&gt;Well, my friend, don&#39;t expect to ever get any better explanation than that, because you won&#39;t.&quot;, &quot;I was looking forward to this movie. Trustworthy actors, interesting plot. Great atmosphere then ????? IF you are going to attempt something that is meant to encapsulate the meaning of life. First. Know it. OK I did not expect the directors or writers to actually know the meaning but I thought they may have offered crumbs to peck at and treats to add fuel to the fire-Which! they almost did. Things I didn&#39;t get. A woman wandering around in dark places and lonely car parks alone-oblivious to the consequences. Great riddles that fell by the wayside. The promise of the knowledge therein contained by the original so-called criminal. I had no problem with the budget and enjoyed the suspense. I understood and can wax lyrical about the fool and found Adrian Pauls role crucial and penetrating and then ????? Basically the story line and the script where good up to a point and that point was the last 10 minutes or so. What? Run out of ideas! Such a pity that this movie had to let us down so badly. It may not comprehend the meaning and I really did not expect the writers to understand it but I was hoping for an intellectual, if not spiritual ride and got a bump in the road&quot;, &#39;Four things intrigued me as to this film - firstly, it stars Carly Pope (of &quot;Popular&quot; fame), who is always a pleasure to watch. Secdonly, it features brilliant New Zealand actress Rena Owen. Thirdly, it is filmed in association with the New Zealand Film Commission. Fourthly, a friend recommended it to me. However, I was utterly disappointed. The whole storyline is absurd and complicated, with very little resolution. Pope\&#39;s acting is fine, but Owen is unfortunately under-used. The other actors and actresses are all okay, but I am unfamiliar with them all. Aside from the nice riddles which are littered throughout the movie (and Pope and Owen), this film isn\&#39;t very good. So the moral of the story is...don\&#39;t watch it unless you really want to.&#39;, &#39;&lt;br /&gt;&lt;br /&gt;Never ever take a film just for its good looking title.&lt;br /&gt;&lt;br /&gt;Although it all starts well, the film suffers the same imperfections you see in B-films. Its like at a certain moment the writer does not any more how to end the film, so he ends it in a way nobody suspects it thinking this way he is ingenious.&lt;br /&gt;&lt;br /&gt;A film to be listed on top of the garbage list.&lt;br /&gt;&lt;br /&gt;&#39;, &quot;Lowe returns to the nest after, yet another, failed relationship, to find he&#39;s been assigned to jury duty. It&#39;s in the plans to, somehow, get out of it, when he realizes the defendant is the girl he&#39;s had a serious crush on since the first grade.&lt;br /&gt;&lt;br /&gt;Through living in the past by telling other people about his feelings towards this girl (played by Camp), Lowe remembers those feelings and does everything in his power to clear Camp of attempted murder, while staying away from the real bad guys at the same time, and succeeding in creating a successful film at the same time.&lt;br /&gt;&lt;br /&gt;I&#39;ve heard that St Augustine is the oldest city in the US, and I also know it has some ties to Ponce de Leon, so the backdrop is a good place to start. Unfortunately, it&#39;s the only thing good about this movie. The local police are inept, the judge is an idiot, and the defense counsel does everything in her power to make herself look like Joanie Cunningham! I don&#39;t know whether to blame the director for poor direction, or for just letting the cast put in such a hapless effort.&lt;br /&gt;&lt;br /&gt;In short, this movie was so boring, I could not even sleep through it! 1 out of 10 stars!&quot;, &#39;Seriously, I can\&#39;t imagine how anyone could find a single flattering thing to say about this movie, much less find it in themselves to write the glowing compliments contained in this comment section. How many methamphetamines was Bogdonovitch on during the filming of this movie? Was he giving a bonus to the actor that spat his lines out with the most speed and least inflection or thought? The dialogue is bad, the plot atrocious, even for a &quot;screwball&quot; comedy, and claims that the movie is an homage to classic film comedy is about the most inane thing I\&#39;ve ever heard. The cinematography is below the quality and innovation of that exhibited by the worst made-for-TV movies, the acting is awful (although I get the feeling that the fault for that lies squarely in the lap of the director), and speaking of which, did I mention the direction is so haphazard and inscrutable that it defies the definition of the word? The whole thing is a terribly unfunny (even in the much-beleaguered world of so-bad-it\&#39;s-funny clunkers), soul-sucking, waste of two hours of your life that you\&#39;ll never get back. Be afraid, be very afraid...&#39;] tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Counter: subclass of Python&#39;s dictionary used for counting hashable objects, in this case, tokens (words).</span>
<span class="c1"># OrderedDict: subclass of Python&#39;s dictionary that remembers the insertion order of keys. It is used to store tokens in a specific order based on frequency.</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span><span class="p">,</span> <span class="n">OrderedDict</span>
<span class="c1"># re: A module for working with regular expressions, used to manipulate and clean text.</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="c1"># Step 1: Token counts and vocab creation</span>
<span class="c1"># Initializes an empty Counter object to hold the frequency of each token in the dataset.</span>
<span class="n">token_counts</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>

<span class="c1"># Define tokenizer</span>
<span class="k">def</span> <span class="nf">tokenizer</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;&lt;[^&gt;]*&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>  <span class="c1"># Remove HTML tags</span>

    <span class="c1"># This converts the entire text string to lowercase to ensure the regex matching is case-insensitive</span>
    <span class="c1"># Emoticons are case-insensitive, so text.lower is not necessary</span>
    <span class="n">emoticons</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;(?::|;|=)(?:-)?(?:\)|\(|D|P)&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>  <span class="c1"># Extract emoticons</span>

    <span class="c1"># \W a shorthand in regex that matches any non-word character. Replace occurrences with space.</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;[\W]+&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">emoticons</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="c1">#adds emoticons to the cleaned text.</span>

    <span class="c1">#  creates a list of words (tokens)</span>
    <span class="n">tokenized</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">tokenized</span>

<span class="c1"># Step 2: Tokenize the training data and populate token_counts</span>
<span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">train_dataset</span><span class="p">:</span>  <span class="c1"># Assuming train_dataset is a dataset with &#39;text&#39;</span>
    <span class="n">line</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span>
    <span class="n">tokens</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    <span class="n">token_counts</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span>

<span class="c1"># Step 3: Sort tokens by frequency</span>
<span class="c1"># token_counts.items() returns the tokens and their respective counts as a list of tuples (e.g., [(token1, count1), (token2, count2), ...])</span>
<span class="c1"># key=lambda x: x[1] means that the sorting is based on the count (x[1]), which is the second element of each tuple</span>
<span class="c1"># reverse=True means that the most frequent tokens appear first in the sorted list.</span>
<span class="n">sorted_by_freq_tuples</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">token_counts</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Step 4: Limit the vocabulary to the top 69023 tokens (including special tokens)</span>
<span class="c1"># The padding token (pad) is used to ensure that all sequences in a batch have the same length.</span>
<span class="c1"># The unknown token (unk) is used to represent words that are not found in the model&#39;s vocabulary (the top 69021 words in your case).</span>
<span class="c1"># Any word that doesn&#39;t appear in the vocabulary is replaced by the unk token during tokenization.</span>
<span class="c1"># This is critical for handling unseen words during inference, where the model encounters words that were not present in the training data.</span>
<span class="n">limited_sorted_by_freq_tuples</span> <span class="o">=</span> <span class="n">sorted_by_freq_tuples</span><span class="p">[:</span><span class="mi">69021</span><span class="p">]</span>  <span class="c1"># Top 69021 + pad and unk</span>

<span class="c1"># Step 5: Create an ordered dictionary for the vocab</span>
<span class="n">ordered_dict</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">(</span><span class="n">limited_sorted_by_freq_tuples</span><span class="p">)</span>

<span class="c1"># Step 6: Create vocab dictionary with special tokens</span>
<span class="c1"># Initializes the vocab dictionary with two special tokens</span>
<span class="n">vocab</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;&lt;pad&gt;&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;&lt;unk&gt;&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>

<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ordered_dict</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">start</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>  <span class="c1"># Start from 2 to skip the special tokens</span>
    <span class="n">vocab</span><span class="p">[</span><span class="n">token</span><span class="p">]</span> <span class="o">=</span> <span class="n">idx</span>


<span class="c1"># Print the vocabulary size (should be 69023)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Vocab-size:&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">vocab</span><span class="p">))</span>

<span class="c1"># --- Rationale:</span>
<span class="c1">#</span>
<span class="c1"># By assigning frequent words lower indices, we can optimize memory and computational efficiency.</span>
<span class="c1"># Words that appear infrequently can either be assigned higher indices (in case we want to keep them) or omitted from the vocabulary entirely.</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Vocab-size: 69023
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">from collections import OrderedDict</span>

<span class="sd"># Step 1: Sort the tokens by frequency and create an ordered dictionary</span>
<span class="sd">sorted_by_freq_tuples = sorted(token_counts.items(), key=lambda x: x[1], reverse=True)</span>
<span class="sd">ordered_dict = OrderedDict(sorted_by_freq_tuples)</span>

<span class="sd"># Step 2: Create the vocab dictionary manually</span>
<span class="sd">vocab = {&quot;&lt;pad&gt;&quot;: 0, &quot;&lt;unk&gt;&quot;: 1}</span>
<span class="sd">for idx, (token, count) in enumerate(ordered_dict.items(), start=2):</span>
<span class="sd">    vocab[token] = idx</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="c1"># Use the vocab to encode a list of tokens</span>
<span class="k">def</span> <span class="nf">encode</span><span class="p">(</span><span class="n">tokens</span><span class="p">):</span>
    <span class="c1">#If the token does not exist in the vocab, the function returns the index of the &lt;unk&gt;</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">vocab</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">vocab</span><span class="p">[</span><span class="s2">&quot;&lt;unk&gt;&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">]</span>
<span class="c1"># Example usage</span>
<span class="nb">print</span><span class="p">(</span><span class="n">encode</span><span class="p">([</span><span class="s1">&#39;this&#39;</span><span class="p">,</span> <span class="s1">&#39;is&#39;</span><span class="p">,</span> <span class="s1">&#39;an&#39;</span><span class="p">,</span> <span class="s1">&#39;example&#39;</span><span class="p">]))</span>  <span class="c1"># Should output something like [11, 7, 35, 457]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[11, 7, 35, 457]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="ow">not</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning: this code may be very slow on CPU&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">torch.nn</span> <span class="k">as</span> <span class="nn">nn</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s2">&quot;cuda&quot;</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;cpu&quot;</span><span class="p">)</span>

<span class="c1"># Use the manual vocab creation process from earlier</span>
<span class="c1"># Assuming `vocab` and `tokenizer` are already defined</span>

<span class="c1">#text_pipeline = lambda x: [vocab[token] for token in tokenizer(x)]</span>
<span class="c1"># Updated text pipeline</span>
<span class="n">text_pipeline</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span><span class="n">vocab</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">vocab</span><span class="p">[</span><span class="s2">&quot;&lt;unk&gt;&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokenizer</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span>

<span class="c1"># Manual label processing, see later</span>
<span class="n">label_pipeline</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># Convert to float to match the output</span>


<span class="c1"># Batch collation function</span>
<span class="k">def</span> <span class="nf">collate_batch</span><span class="p">(</span><span class="n">batch</span><span class="p">):</span>
    <span class="n">label_list</span><span class="p">,</span> <span class="n">text_list</span><span class="p">,</span> <span class="n">lengths</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">batch</span><span class="p">:</span>  <span class="c1"># Each &#39;entry&#39; is a dictionary with &#39;text&#39; and &#39;label&#39;</span>
        <span class="n">_label</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>
        <span class="n">_text</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span>

        <span class="c1"># Process labels and text</span>
        <span class="n">label_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label_pipeline</span><span class="p">(</span><span class="n">_label</span><span class="p">))</span>  <span class="c1"># Convert labels using label_pipeline</span>
        <span class="n">processed_text</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">text_pipeline</span><span class="p">(</span><span class="n">_text</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>  <span class="c1"># Convert text to indices</span>

        <span class="c1"># Store processed text and its length</span>
        <span class="n">text_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">processed_text</span><span class="p">)</span>
        <span class="n">lengths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">processed_text</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>

    <span class="c1"># Convert lists to tensors and pad sequences</span>
    <span class="n">label_list</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">label_list</span><span class="p">)</span>
    <span class="n">lengths</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">lengths</span><span class="p">)</span>
    <span class="n">padded_text_list</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">rnn</span><span class="o">.</span><span class="n">pad_sequence</span><span class="p">(</span><span class="n">text_list</span><span class="p">,</span> <span class="n">batch_first</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">padded_text_list</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">),</span> <span class="n">label_list</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">),</span> <span class="n">lengths</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#-----  Example usage with DataLoader -----#</span>
<span class="c1">## Take a small batch</span>

<span class="n">dataloader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">collate_fn</span><span class="o">=</span><span class="n">collate_batch</span><span class="p">)</span>
<span class="n">text_batch</span><span class="p">,</span> <span class="n">label_batch</span><span class="p">,</span> <span class="n">length_batch</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">dataloader</span><span class="p">))</span>

<span class="c1"># Print the output batch</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Text batch:&quot;</span><span class="p">,</span> <span class="n">text_batch</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Label batch:&quot;</span><span class="p">,</span> <span class="n">label_batch</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Length batch:&quot;</span><span class="p">,</span> <span class="n">length_batch</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Text batch shape:&quot;</span><span class="p">,</span> <span class="n">text_batch</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text batch: tensor([[   35,  1739,     7,   449,   721,     6,   301,     4,   787,     9,
             4,    18,    44,     2,  1705,  2460,   186,    25,     7,    24,
           100,  1874,  1739,    25,     7, 34415,  3568,  1103,  7517,   787,
             5,     2,  4991, 12401,    36,     7,   148,   111,   939,     6,
         11598,     2,   172,   135,    62,    25,  3199,  1602,     3,   928,
          1500,     9,     6,  4601,     2,   155,    36,    14,   274,     4,
         42945,     9,  4991,     3,    14, 10296,    34,  3568,     8,    51,
           148,    30,     2,    58,    16,    11,  1893,   125,     6,   420,
          1214,    27, 14542,   940,    11,     7,    29,   951,    18,    17,
         15994,   459,    34,  2480, 15211,  3713,     2,   840,  3200,     9,
          3568,    13,   107,     9,   175,    94,    25,    51, 10297,  1796,
            27,   712,    16,     2,   220,    17,     4,    54,   722,   238,
           395,     2,   787,    32,    27,  5236,     3,    32,    27,  7252,
          5118,  2461,  6390,     4,  2873,  1495,    15,     2,  1054,  2874,
           155,     3,  7015,     7,   409,     9,    41,   220,    17,    41,
           390,     3,  3925,   807,    37,    74,  2858,    15, 10297,   115,
            31,   189,  3506,   667,   163,     0,     0,     0,     0,     0,
             0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
             0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
             0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
             0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
             0,     0,     0,     0,     0,     0,     0,     0],
        [  216,   175,   724,     5,    11,    18,    10,   226,   110,    14,
           182,    78,     8,    13,    24,   182,    78,     8,    13,   166,
           182,    50,   150,    24,    85,     2,  4031,  5935,   107,    96,
            28,  1867,   602,    19,    52,   162,    21,  1698,     8,     6,
          1181,   367,     2,   351,    10,   140,   419,     4,   333,     5,
          6022,  7136,  5055,  1209, 10892,    32,   219,     9,     2,   405,
          1413,    13,  4031,    13,  1099,     7,    85,    19,     2,    20,
          1018,     4,    85,   565,    34,    24,   807,    55,     5,    68,
           658,    10,   507,     8,     4,   668,     0,     0,     0,     0,
             0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
             0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
             0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
             0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
             0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
             0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
             0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
             0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
             0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
             0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
             0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
             0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
             0,     0,     0,     0,     0,     0,     0,     0],
        [   10,   121,    24,    28,    98,    74,   589,     9,   149,     2,
          7372,  3030, 14543,  1012,   520,     2,   985,  2327,     5, 16847,
          5479,    19,    25,    67,    76,  3478,    38,     2,  7372,     3,
            25,    67,    76,  2951,    34,    35, 10893,   155,   449, 29495,
         23725,    10,    67,     2,   554,    12, 14543,    67,    91,     4,
            50,    20,    19,     8,    67,    24,  4228,     2,  2142,    37,
            33,  3478,    87,     3,  2564,   160,   155,    11,   634,   126,
            24,   158,    72,   286,    13,   373,     2,  4804,    19,     2,
          7372,  6794,     6,    30,   128,    73,    48,    10,   886,     8,
            13,    24,     4,    85,    20,    19,     8,    13,    35,   218,
             3,   428,   710,     2,   107,   936,     7,    54,    72,   223,
             3,    10,    96,   122,     2,   103,    54,    72,    82,     2,
           658,   202,     2,   106,   293,   103,     7,  1193,     3,  3031,
           708,  5760,     3,  2918,  3991,   706,  3327,   349,   148,   286,
            13,   139,     6,     2,  1501,   750,    29,  1407,    62,    65,
          2612,    71,    40,    14,     4,   547,     9,    62,     8,  7943,
            71,    14,     2,  5687,     5,  4868,  3111,     6,   205,     2,
            18,    55,  2075,     3,   403,    12,  3111,   231,    45,     5,
           271,     3,    68,  1400,     7,  9774,   932,    10,   102,     2,
            20,   143,    28,    76,    55,  3810,     9,  2723,     5,    12,
            10,   379,     2,  7372,    15,     4,    50,   710,     8,    13,
            24,   887,    32,    31,    19,     8,    13,   428],
        [18923,     7,     4,  4753,  1669,    12,  3019,     6,     4, 13906,
           502,    40,    25,    77,  1588,     9,   115,     6, 21713,     2,
            90,   305,   237,     9,   502,    33,    77,   376,     4, 16848,
           847,    62,    77,   131,     9,     2,  1580,   338,     5, 18923,
            32,     2,  1980,    49,   157,   306, 21713,    46,   981,     6,
         10298,     2, 18924,   125,     9,   502,     3,   453,     4,  1852,
           630,   407,  3407,    34,   277,    29,   242,     2, 20200,     5,
         18923,    77,    95,    41,  1833,     6,  2105,    56,     3,   495,
           214,   528,     2,  3479,     2,   112,     7,   181,  1813,     3,
           597,     5,     2,   156,   294,     4,   543,   173,     9,  1562,
           289, 10038,     5,     2,    20,    26,   841,  1392,    62,   130,
           111,    72,   832,    26,   181, 12402,    15,    69,   183,     6,
            66,    55,   936,     5,     2,    63,     8,     7,    43,     4,
            78, 23726, 15995,    13,    20,    17,   800,     5,   392,    59,
          3992,     3,   371,   103,  2596,     0,     0,     0,     0,     0,
             0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
             0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
             0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
             0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
             0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
             0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
             0,     0,     0,     0,     0,     0,     0,     0]],
       device=&#39;cuda:0&#39;)
Label batch: tensor([1., 1., 1., 0.], device=&#39;cuda:0&#39;)
Length batch: tensor([165,  86, 218, 145], device=&#39;cuda:0&#39;)
Text batch shape: torch.Size([4, 218])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#------------------------------------- TESTS -------------------------------------</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check the first few labels in the dataset</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Label </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">train_dataset</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Label 0: 1
Label 1: 1
Label 2: 1
Label 3: 0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Debug tokenization and vocab lookup</span>
<span class="n">sample_text</span> <span class="o">=</span> <span class="s2">&quot;This is an example sentence.&quot;</span>
<span class="n">tokens</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="p">(</span><span class="n">sample_text</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Tokens:&quot;</span><span class="p">,</span> <span class="n">tokens</span><span class="p">)</span>  <span class="c1"># Should print tokenized text</span>

<span class="n">token_indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">vocab</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">vocab</span><span class="p">[</span><span class="s2">&quot;&lt;unk&gt;&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Token indices:&quot;</span><span class="p">,</span> <span class="n">token_indices</span><span class="p">)</span>  <span class="c1"># Should print the vocab indices for each token</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Tokens: [&#39;this&#39;, &#39;is&#39;, &#39;an&#39;, &#39;example&#39;, &#39;sentence&#39;]
Token indices: [11, 7, 35, 457, 4063]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Access both text and label for the first 5 entries</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">entry</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Text: </span><span class="si">{</span><span class="n">entry</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, Label: </span><span class="si">{</span><span class="n">entry</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text: An extra is called upon to play a general in a movie about the Russian Revolution. However, he is not any ordinary extra. He is Serguis Alexander, former commanding general of the Russia armies who is now being forced to relive the same scene, which he suffered professional and personal tragedy in, to satisfy the director who was once a revolutionist in Russia and was humiliated by Alexander. It can now be the time for this broken man to finally &quot;win&quot; his penultimate battle. This is one powerful movie with meticulous direction by Von Sternberg, providing the greatest irony in Alexander&#39;s character in every way he can. Jannings deserved his Oscar for the role with a very moving performance playing the general at his peak and at his deepest valley. Powell lends a sinister support as the revenge minded director and Brent is perfect in her role with her face and movements showing so much expression as Jannings&#39; love. All around brilliance. Rating, 10., Label: 1
Text: almost every review of this movie I&#39;d seen was pretty bad. It&#39;s not pretty bad, it&#39;s actually pretty good, though not great. The Judy Garland character could have gotten annoying, but she didn&#39;t allow it to. Somewhere along the line, i&#39;ve become a fan of brooding, overbearing, overacting Van Heflin, at least in the early 40&#39;s. Judy&#39;s singing is great, but the film missed a great chance by not showing more of their relationship. I gave it a 7., Label: 1
Text: I did not have too much interest in watching The Flock.Andrew Lau co-directed the masterpiece trilogy of Infernal Affairs but he had been fired from The Flock and he had been replaced by an emergency director called Niels Mueller.I had the feeling that Lau had made a good film but it had not satisfied the study,so they fired him and hired another director.This usually does not work well (let&#39;s remember The Invasion).But The Flock resulted to be better than what I expected.It&#39;s not a great film but it&#39;s an interesting and entertaining thriller.The character development is very well done and I could know the characters very well.Also,the relationship between the two main characters is natural and credible.Richard Gere and Claire Danes bring competent performances.Now,let&#39;s go to the negative points.One element which really bothered me (there was a moment in which it irritated me) was the excess of edition tricks to give the movie more &quot;attitude&quot; and style.That tricks feel out of place and their presence is arbitrary.Plus,I think the film should have been more ambitious.In spite of that,I recommend The Flock as a good thriller.It&#39;s not memorable at all,but it&#39;s entertaining., Label: 1
Text: Ulises is a literature teacher that arrives to a coastal town. There, he will fell in love to Martina, the most beautiful girl in town. They will start a torrid romance which will end in the tragic death of Ulises at the sea. Some years later, Martina has married to Sierra, the richest man in town and lives a quiet happy live surrounded by money. One day, the apparition of Ulises will make her passion to rise up and act without thinking the consequences. The plot is quite absurd and none of the actors plays a decent part. IN addition, three quarters of the film are sexual acts, which, still being well filmed, are quite tiring, as we want to see More development of the story. It is just a bad Bigas Luna&#39;s film, with lots of sex, no argument and stupid characters everywhere., Label: 0
Text: I found The FBI Story considerably entertaining and suitably upbeat for my New Years Day holiday viewing. Its drama and action-packed episodes were thrilling. The Hardesty character was well drawn and admirable. Overall the photography, script and direction was perfectly creditable. Rather than taking the film to be a repugnant piece of propaganda, as some might, I enjoyed it as a well mounted portrayal of the necessity of ingenious minds and brave bodies in the fight against crime. Again, the depiction of a family holding together even under the strain of the husband&#39;s commitment to his (arguably) important work, I did not find to be a twee representation but an ideal and exemplary one., Label: 1
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#------------------------------------------------------------------------------</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Batching the datasets</span>

<span class="n">batch_size</span> <span class="o">=</span> <span class="mi">32</span>

<span class="n">train_dl</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span>
                      <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">collate_fn</span><span class="o">=</span><span class="n">collate_batch</span><span class="p">)</span>
<span class="n">valid_dl</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">valid_dataset</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span>
                      <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">collate_fn</span><span class="o">=</span><span class="n">collate_batch</span><span class="p">)</span>
<span class="n">test_dl</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">test_dataset</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span>
                     <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">collate_fn</span><span class="o">=</span><span class="n">collate_batch</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="embedding-layers-for-sentence-encoding">
<h2><span class="section-number">22.3. </span>Embedding layers for sentence encoding<a class="headerlink" href="#embedding-layers-for-sentence-encoding" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">input_dim</span></code>: number of words, i.e. maximum integer index + 1.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">output_dim</span></code>:</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">input_length</span></code>: the length of (padded) sequence</p>
<ul>
<li><p>for example, <code class="docutils literal notranslate"><span class="pre">'This</span> <span class="pre">is</span> <span class="pre">an</span> <span class="pre">example'</span> <span class="pre">-&gt;</span> <span class="pre">[0,</span> <span class="pre">0,</span> <span class="pre">0,</span> <span class="pre">0,</span> <span class="pre">0,</span> <span class="pre">0,</span> <span class="pre">3,</span> <span class="pre">1,</span> <span class="pre">8,</span> <span class="pre">9]</span></code><br />
=&gt; input_lenght is 10</p></li>
</ul>
</li>
<li><p>When calling the layer, takes integr values as input,<br />
the embedding layer convert each interger into float vector of size <code class="docutils literal notranslate"><span class="pre">[output_dim]</span></code></p>
<ul>
<li><p>If input shape is <code class="docutils literal notranslate"><span class="pre">[BATCH_SIZE]</span></code>, output shape will be <code class="docutils literal notranslate"><span class="pre">[BATCH_SIZE,</span> <span class="pre">output_dim]</span></code></p></li>
<li><p>If input shape is <code class="docutils literal notranslate"><span class="pre">[BATCH_SIZE,</span> <span class="pre">10]</span></code>, output shape will be <code class="docutils literal notranslate"><span class="pre">[BATCH_SIZE,</span> <span class="pre">10,</span> <span class="pre">output_dim]</span></code></p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># URL of the image from GitHub</span>
<span class="n">img_url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/cfteach/NNDL_DATA621/860d5f694ae8642fad21fba91e1a233e44a74881/DATA621/DATA621/images/Indexing_comments_IMDB.png&quot;</span>

<span class="c1"># Display the image</span>
<span class="n">Image</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">img_url</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mi">600</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><img src="https://raw.githubusercontent.com/cfteach/NNDL_DATA621/860d5f694ae8642fad21fba91e1a233e44a74881/DATA621/DATA621/images/Indexing_comments_IMDB.png" width="600"/></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The embedding layer in the code is used for converting integer indices</span>
<span class="c1"># (which represent words or tokens in the vocabulary) into dense vector representations,</span>
<span class="c1"># also known as embeddings</span>

<span class="c1"># ---&gt; words with similar meanings or roles (based on the task) end up with similar vector representations</span>

<span class="c1"># e.g.,</span>
<span class="n">embedding</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span><span class="n">num_embeddings</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="c1"># This specifies the size of the vocabulary. In this example, it has 10 indices (from 0 to 9)</span>
                         <span class="n">embedding_dim</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="c1"># Each token in the vocabulary will be represented by a 3-dimensional vector.</span>
                         <span class="n">padding_idx</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># This is used to specify that index 0 is reserved for padding.</span>
                                        <span class="c1">#The embedding corresponding to the index 0 will be all zeros, and it will not be updated during training.</span>
                                        <span class="c1"># Padding is typically used when input sequences of varying lengths are padded with zeros</span>
                                        <span class="c1"># to make them of the same length.</span>

<span class="c1"># a batch of 2 samples of 4 indices each</span>
<span class="n">text_encoded_input</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">],[</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">embedding</span><span class="p">(</span><span class="n">text_encoded_input</span><span class="p">))</span>

<span class="c1"># The embedding layer can be thought of as a parameterized layer in a neural network.</span>
<span class="c1">#  Unlike fully connected layers where you often apply activation functions, it is purely a lookup operation followed by gradient-based learning.</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>tensor([[[ 0.3430, -0.5329, -0.7423],
         [-0.3842,  0.4307, -0.5028],
         [ 0.5857, -0.2052,  2.7972],
         [ 1.0885,  0.5652,  0.2847]],

        [[ 0.5857, -0.2052,  2.7972],
         [ 0.4700,  1.9600, -0.3665],
         [-0.3842,  0.4307, -0.5028],
         [ 0.0000,  0.0000,  0.0000]]], grad_fn=&lt;EmbeddingBackward0&gt;)
</pre></div>
</div>
</div>
</div>
</section>
<section id="building-an-rnn-model">
<h2><span class="section-number">22.4. </span>Building an RNN model<a class="headerlink" href="#building-an-rnn-model" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><strong>RNN layers:</strong></p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">nn.RNN(input_size,</span> <span class="pre">hidden_size,</span> <span class="pre">num_layers=1)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nn.LSTM(..)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nn.GRU(..)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nn.RNN(input_size,</span> <span class="pre">hidden_size,</span> <span class="pre">num_layers=1,</span> <span class="pre">bidirectional=True)</span></code></p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">## EXAMPLE</span>
<span class="sd">## with simple RNN layer</span>

<span class="sd"># Fully connected neural network with one hidden layer</span>
<span class="sd">class RNN(nn.Module):</span>
<span class="sd">    def __init__(self, input_size, hidden_size):</span>
<span class="sd">        super().__init__()</span>
<span class="sd">        self.rnn = nn.RNN(input_size, # specifies the number of features</span>
<span class="sd">                          hidden_size,</span>
<span class="sd">                          num_layers=2,</span>
<span class="sd">                          batch_first=True)</span>
<span class="sd">        #self.gru = nn.GRU(input_size, hidden_size, num_layers, batch_first=True)</span>
<span class="sd">        #self.lstm = nn.LSTM(input_size, hidden_size, num_layers, batch_first=True)</span>
<span class="sd">        self.fc = nn.Linear(hidden_size, 1)</span>

<span class="sd">    def forward(self, x):</span>
<span class="sd">        _, hidden = self.rnn(x)</span>
<span class="sd">        out = hidden[-1, :, :] # select last layer of hidden units, for all (:) sequencs in the batch and for all (:) features in the hidden unit</span>
<span class="sd">        out = self.fc(out)</span>
<span class="sd">        return out</span>

<span class="sd">model = RNN(64, 32)</span>

<span class="sd">print(model)</span>


<span class="sd">model(torch.randn(5, 3, 64)) # 5 batches, 3 times steps, 64 features</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;\n## An example of building a RNN model\n## with simple RNN layer\n\n# Fully connected neural network with one hidden layer\nclass RNN(nn.Module):\n    def __init__(self, input_size, hidden_size):\n        super().__init__()\n        self.rnn = nn.RNN(input_size, # specifies the number of features\n                          hidden_size, \n                          num_layers=2, \n                          batch_first=True)\n        #self.gru = nn.GRU(input_size, hidden_size, num_layers, batch_first=True)\n        #self.lstm = nn.LSTM(input_size, hidden_size, num_layers, batch_first=True)\n        self.fc = nn.Linear(hidden_size, 1)\n        \n    def forward(self, x):\n        _, hidden = self.rnn(x)\n        out = hidden[-1, :, :]\n        out = self.fc(out)\n        return out\n\nmodel = RNN(64, 32) \n\nprint(model) \n \n\nmodel(torch.randn(5, 3, 64)) # 5 batches, 3 times steps, 64 features\n&#39;
</pre></div>
</div>
</div>
</div>
</section>
<section id="building-an-rnn-model-for-the-sentiment-analysis-task">
<h2><span class="section-number">22.5. </span>Building an RNN model for the sentiment analysis task<a class="headerlink" href="#building-an-rnn-model-for-the-sentiment-analysis-task" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># In the following, the embedding layer creates the number of features that will be fed into the RNN</span>

<span class="k">class</span> <span class="nc">RNN</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vocab_size</span><span class="p">,</span> <span class="n">embed_dim</span><span class="p">,</span> <span class="n">rnn_hidden_size</span><span class="p">,</span> <span class="n">fc_hidden_size</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">embedding</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span><span class="n">vocab_size</span><span class="p">,</span>
                                      <span class="n">embed_dim</span><span class="p">,</span>
                                      <span class="n">padding_idx</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rnn</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">LSTM</span><span class="p">(</span><span class="n">embed_dim</span><span class="p">,</span> <span class="n">rnn_hidden_size</span><span class="p">,</span>
                           <span class="n">batch_first</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fc1</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">rnn_hidden_size</span><span class="p">,</span> <span class="n">fc_hidden_size</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relu</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fc2</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">fc_hidden_size</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sigmoid</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sigmoid</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">lengths</span><span class="p">):</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">rnn</span><span class="o">.</span><span class="n">pack_padded_sequence</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">lengths</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="n">enforce_sorted</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">batch_first</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">out</span><span class="p">,</span> <span class="p">(</span><span class="n">hidden</span><span class="p">,</span> <span class="n">cell</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rnn</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">hidden</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fc1</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fc2</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigmoid</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span>

<span class="n">vocab_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vocab</span><span class="p">)</span>
<span class="n">embed_dim</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">rnn_hidden_size</span> <span class="o">=</span> <span class="mi">64</span>
<span class="n">fc_hidden_size</span> <span class="o">=</span> <span class="mi">64</span>

<span class="n">torch</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">RNN</span><span class="p">(</span><span class="n">vocab_size</span><span class="p">,</span> <span class="n">embed_dim</span><span class="p">,</span> <span class="n">rnn_hidden_size</span><span class="p">,</span> <span class="n">fc_hidden_size</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="n">dataloader</span><span class="p">):</span>
    <span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
    <span class="n">total_acc</span><span class="p">,</span> <span class="n">total_loss</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">text_batch</span><span class="p">,</span> <span class="n">label_batch</span><span class="p">,</span> <span class="n">lengths</span> <span class="ow">in</span> <span class="n">dataloader</span><span class="p">:</span>
        <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
        <span class="n">pred</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">text_batch</span><span class="p">,</span> <span class="n">lengths</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="n">loss_fn</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">label_batch</span><span class="p">)</span>
        <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
        <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
        <span class="n">total_acc</span> <span class="o">+=</span> <span class="p">((</span><span class="n">pred</span><span class="o">&gt;=</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">()</span> <span class="o">==</span> <span class="n">label_batch</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
        <span class="n">total_loss</span> <span class="o">+=</span> <span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">()</span><span class="o">*</span><span class="n">label_batch</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">total_acc</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">dataloader</span><span class="o">.</span><span class="n">dataset</span><span class="p">),</span> <span class="n">total_loss</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">dataloader</span><span class="o">.</span><span class="n">dataset</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="n">dataloader</span><span class="p">):</span>
    <span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
    <span class="n">total_acc</span><span class="p">,</span> <span class="n">total_loss</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
    <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">text_batch</span><span class="p">,</span> <span class="n">label_batch</span><span class="p">,</span> <span class="n">lengths</span> <span class="ow">in</span> <span class="n">dataloader</span><span class="p">:</span>
            <span class="n">pred</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">text_batch</span><span class="p">,</span> <span class="n">lengths</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">loss</span> <span class="o">=</span> <span class="n">loss_fn</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">label_batch</span><span class="p">)</span>
            <span class="n">total_acc</span> <span class="o">+=</span> <span class="p">((</span><span class="n">pred</span><span class="o">&gt;=</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">()</span> <span class="o">==</span> <span class="n">label_batch</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
            <span class="n">total_loss</span> <span class="o">+=</span> <span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">()</span><span class="o">*</span><span class="n">label_batch</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">total_acc</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">dataloader</span><span class="o">.</span><span class="n">dataset</span><span class="p">),</span> <span class="n">total_loss</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">dataloader</span><span class="o">.</span><span class="n">dataset</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">loss_fn</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">BCELoss</span><span class="p">()</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span>

<span class="n">num_epochs</span> <span class="o">=</span> <span class="mi">10</span>

<span class="n">torch</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_epochs</span><span class="p">):</span>
    <span class="n">acc_train</span><span class="p">,</span> <span class="n">loss_train</span> <span class="o">=</span> <span class="n">train</span><span class="p">(</span><span class="n">train_dl</span><span class="p">)</span>
    <span class="n">acc_valid</span><span class="p">,</span> <span class="n">loss_valid</span> <span class="o">=</span> <span class="n">evaluate</span><span class="p">(</span><span class="n">valid_dl</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Epoch </span><span class="si">{</span><span class="n">epoch</span><span class="si">}</span><span class="s1"> accuracy: </span><span class="si">{</span><span class="n">acc_train</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1"> val_accuracy: </span><span class="si">{</span><span class="n">acc_valid</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 0 accuracy: 0.6120 val_accuracy: 0.6610
Epoch 1 accuracy: 0.7511 val_accuracy: 0.7520
Epoch 2 accuracy: 0.8004 val_accuracy: 0.7974
Epoch 3 accuracy: 0.8266 val_accuracy: 0.8144
Epoch 4 accuracy: 0.8768 val_accuracy: 0.8392
Epoch 5 accuracy: 0.8703 val_accuracy: 0.8274
Epoch 6 accuracy: 0.8986 val_accuracy: 0.8372
Epoch 7 accuracy: 0.9111 val_accuracy: 0.8424
Epoch 8 accuracy: 0.9399 val_accuracy: 0.8444
Epoch 9 accuracy: 0.9513 val_accuracy: 0.8568
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">acc_test</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">evaluate</span><span class="p">(</span><span class="n">test_dl</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;test_accuracy: </span><span class="si">{</span><span class="n">acc_test</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>test_accuracy: 0.8474
</pre></div>
</div>
</div>
</div>
</section>
<section id="select-one-random-comment-in-the-test-dataset-and-compute-prediction">
<h2><span class="section-number">22.6. </span>Select one random comment in the test dataset and compute prediction<a class="headerlink" href="#select-one-random-comment-in-the-test-dataset-and-compute-prediction" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">random</span>

<span class="c1"># Function to preprocess and predict a single comment</span>
<span class="k">def</span> <span class="nf">predict_comment</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">vocab</span><span class="p">):</span>
    <span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>

    <span class="c1"># Tokenize and encode the input text using the same tokenizer and vocab as used during training</span>
    <span class="n">tokens</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">encoded_text</span> <span class="o">=</span> <span class="p">[</span><span class="n">vocab</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">vocab</span><span class="p">[</span><span class="s2">&quot;&lt;unk&gt;&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">]</span>

    <span class="c1"># Convert the tokens to tensor and add batch dimension</span>
    <span class="n">text_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">encoded_text</span><span class="p">)</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>  <span class="c1"># Add batch dimension</span>

    <span class="c1"># Length tensor (since we are processing a single comment, length is just the length of the sequence)</span>
    <span class="n">lengths_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">encoded_text</span><span class="p">)])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
        <span class="n">prediction</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">text_tensor</span><span class="p">,</span> <span class="n">lengths_tensor</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Apply threshold of 0.5 for binary classification (as the model uses Sigmoid)</span>
    <span class="n">prediction_label</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">prediction</span> <span class="o">&gt;=</span> <span class="mf">0.5</span> <span class="k">else</span> <span class="mi">0</span>

    <span class="k">return</span> <span class="n">prediction</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span> <span class="n">prediction_label</span>

<span class="c1"># Select a random sample from the test dataset</span>
<span class="n">random_index</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_dataset</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">random_comment</span> <span class="o">=</span> <span class="n">test_dataset</span><span class="p">[</span><span class="n">random_index</span><span class="p">][</span><span class="s1">&#39;text&#39;</span><span class="p">]</span>
<span class="n">random_label</span> <span class="o">=</span> <span class="n">test_dataset</span><span class="p">[</span><span class="n">random_index</span><span class="p">][</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>

<span class="c1"># Make a prediction on this random comment</span>
<span class="n">predicted_value</span><span class="p">,</span> <span class="n">predicted_label</span> <span class="o">=</span> <span class="n">predict_comment</span><span class="p">(</span><span class="n">random_comment</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">vocab</span><span class="p">)</span>

<span class="c1"># Output the result</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Random comment: </span><span class="si">{</span><span class="n">random_comment</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;True label: </span><span class="si">{</span><span class="n">random_label</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Predicted value: </span><span class="si">{</span><span class="n">predicted_value</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Predicted label: </span><span class="si">{</span><span class="n">predicted_label</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Random comment: Los Angeles, 1976. Indie film brat John Carpenter, fresh out of film school and with one film - his class project&#39;s no-budget spoof of 2001 called Dark Star - under his belt, finishes a gritty actioner called Assault On Precinct 13. The story of an almost deserted police station under siege by an unseen LA gang, it was a minor hit on the drive-in circuit and garnered small praise from the few critics who cared, but it hardly set the film world on fire, unlike Carpenter&#39;s follow-up smash Halloween (1978). On Precinct, Carpenter was still learning how to exploit his almost non-existent budget by using lower-shelf actors, keeping the action to the one hellishly small location, and moving the film along at a tight pace with a combination of editing, intelligent camera work and switched-on genre savvy.&lt;br /&gt;&lt;br /&gt;No-one wants or needs to be hungry in Hollywood anymore, particularly if the week&#39;s catering bill on the 2005 version of Assault On Precinct 13 is more than the entire cost of the original. It does translate into a certain kind of laziness on a filmmaker&#39;s part - you have a stupidly large union crew, a studio and a marketing firm all doing your thinking for you. Which is why twenty years after watching Carpenter&#39;s film I can still see every glorious moment, from the small girl gunned down in cold blood while buying an ice cream, to the relentless pounding synth score. A week after Assault 2005, I remember Larry Fishburne&#39;s unmoving ping pong ball eyes and little else.&lt;br /&gt;&lt;br /&gt;&quot;Forgettable popcorn actioner&quot; fits the top of the poster perfectly. It&#39;s New Years Eve at Precinct 13, a station closing down with a skeleton staff to see in its final hours. On call is Jake Roenick (Ethan Hawke), an ex-narc now deeply troubled and hopped up on Jack Daniels and Seconol after his partners were iced in the opening scene; Iris (The Sopranos&#39; Drea de Matteo), a nympho with a thing for criminal types, and Jasper (Brian Dennehy), a crusty old timer one scotch away from retirement. As in Carpenter&#39;s Assault..., a bus with four heavy-duty criminals is rerouted to the Precinct. All boozy eyes are on gangster kingpin Bishop (Fishburne, still beefed-up from his time in the Matrix) who has narrowly survived an assassination attempt from an undercover cop and plans to blow the lid on the endemic corruption in the organized crime unit led by Marcus Duvall (a tired-looking Gabriel Byrne). Soon the phones are out, the power lines are down, and both crims and police find themselves heavily armed with a serious police arsenal and consumed with paranoia while waging war against a task force of Duvall&#39;s corrupt cops sporting white balaclavas, bullet vests, infra-red bazookas and more high-tech gear than the Skywalker Ranch. This, we&#39;re expected to believe as the helicopters buzz around the top of the police station shooting rockets into windows, is a clandestine operation to cover Duvall&#39;s tracks. He may as well have taken out billboards on Hollywood Boulevard.&lt;br /&gt;&lt;br /&gt;As with the recent Seventies genre reworking Dawn Of The Dead, Assault 2005 takes the barest plot essentials of John Carpenter&#39;s original and, to quote the Seventies, &quot;does it&#39;s own thing, man&quot;. The main question is - why bother? John Carpenter&#39;s 1976 is a cult favorite among genre buffs, but is hardly branded in the public&#39;s collective consciousness. Carpenter himself was busy reworking Howard Hawks&#39; classic western Rio Bravo into a tight, claustrophobic urban thriller for only $20,000. French wunderkind director and rap producer Jean-Francois Richet, a self-professed fan of John Carpenter&#39;s work, seems less concerned with making an homage to either Hawks or JC - although the script is peppered with references to cowboys and injuns - and seems intent on squeezing in as much flash and firepower as the multi-million dollar budget can withstand. The result: some tense moments with hand-held POV cameras, an unexpectedly high (and bloody) body count, a few neat plot twists, but essentially a B-grade urban actioner with a much inflated price tag. As for name-checking Carpenter, it&#39;s pure conceit on the part of the filmmakers that doesn&#39;t pay off.&lt;br /&gt;&lt;br /&gt;To Monsieur Richet, I say bon voyage, and I wish you luck on your music career.
True label: 0
Predicted value: 0.0203
Predicted label: 0
</pre></div>
</div>
</div>
</div>
</section>
<section id="build-a-bi-directional-lstm">
<h2><span class="section-number">22.7. </span>Build a bi-directional LSTM<a class="headerlink" href="#build-a-bi-directional-lstm" title="Link to this heading">#</a></h2>
<p>Recall:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">nn.RNN(input_size,</span> <span class="pre">hidden_size,</span> <span class="pre">num_layers=1)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nn.LSTM(..)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nn.GRU(..)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nn.RNN(input_size,</span> <span class="pre">hidden_size,</span> <span class="pre">num_layers=1,</span> <span class="pre">bidirectional=True)</span></code></p></li>
</ul>
<p><strong>Do you expect this to perform better?</strong></p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "cfteach/NNDL_DATA621",
            ref: "webpage-src",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="nobel2024.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">21. </span>Nobel Prize (2024)</p>
      </div>
    </a>
    <a class="right-next"
       href="referencesmc.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">References</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#warming-up">22.1. Warming up</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#working-with-the-internet-movie-database-imdb">22.2. Working with the Internet Movie Database (IMDb)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#embedding-layers-for-sentence-encoding">22.3. Embedding layers for sentence encoding</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#building-an-rnn-model">22.4. Building an RNN model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#building-an-rnn-model-for-the-sentiment-analysis-task">22.5. Building an RNN model for the sentiment analysis task</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#select-one-random-comment-in-the-test-dataset-and-compute-prediction">22.6. Select one random comment in the test dataset and compute prediction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#build-a-bi-directional-lstm">22.7. Build a bi-directional LSTM</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Cristiano Fanelli
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
<div class="extra_footer">
  DATA621
</div>
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>